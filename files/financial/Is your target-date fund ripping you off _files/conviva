!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s="4318e9874f69adaa4bca")}({"4318e9874f69adaa4bca":function(e,t,n){"use strict";(function(t){e.exports=t.Conviva=n("8acc8302a73f3f9b928d")}).call(t,n("698d75b157f24ae829cc"))},"698d75b157f24ae829cc":function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"8acc8302a73f3f9b928d":function(e,t,n){var i,r;!function(a,o){if(i=o,void 0!==(r="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=r),void 0!==a){if(void 0!==a.Conviva)return;if(a.ConvivaLoading)return;a.ConvivaLoading=!0,a.Conviva=o(),delete a.ConvivaLoading}}(this,function(){var e={};return function(){"use strict";var t={};!function(){var n=e.Client=function(t,o){function _(e,t){if(!(e instanceof i))throw new Error("clientSettings parameter should be an instance of ClientSettings.");if(!(t instanceof a))throw new Error("systemFactory parameter should be an instance of SystemFactory.");e.gatewayUrl!=i._httpsProtocol+i.defaultProductionGatewayDNS&&e.gatewayUrl!=i._httpProtocol+i.defaultProductionGatewayDNS||(this.defaultGatewayURLError=!0),this._settings=e.clone(),this._systemFactory=t,this._systemFactory.configure("SDK",this._settings),this._exceptionCatcher=this._systemFactory.buildExceptionCatcher(),this._exceptionCatcher.runProtected("Client.init",function(){l._id=U.uinteger32(),l._logger=l._systemFactory.buildLogger(),l._logger.setModuleName("Client"),l.defaultGatewayURLError&&l._logger.info("Gateway URL should not be set to https://cws.conviva.com or http://cws.conviva.com, therefore this call is ignored"),l._logger.info("init(): url="+l._settings.gatewayUrl+" customerKey="+l._settings.customerKey),l._config=l._systemFactory.buildConfig(),l._config.load(),l._sessionFactory=l._systemFactory.buildSessionFactory(l,l._settings,l._config),l._logger.info("init(): done.")},function(e){throw new Error("Client constructor failed: "+e.message)})}var l=this;this.defaultGatewayURLError=!1,this._logger=null,this._sessionFactory=null,this._systemFactory=null,this._globalSessionKey=-1,this._settings=null,this._systemSettings=null,this._exceptionCatcher=null,this._config=null,this._id=-1,this._released=!1,this._uniqueIdentifiers={},this._uniqueIdentifierCallback=function(e){l._logger.info(" Client:: uniqueIdentifierCallback(): "+e)},this._userPrefForData={},_.apply(this,arguments),this.release=function(){this._released||this._exceptionCatcher.runProtected("Client.release",function(){l._logger.info("release()"),l._sessionFactory.cleanup(),l._sessionFactory=null,l._globalSessionKey=-1,l._logger=null,l._id=-1,l._exceptionCatcher=null,l._settings=null,l._systemSettings=null,l._systemFactory=null,l._released=!0})},this.createSession=function(e){var t=n.NO_SESSION_KEY;return this._released?t:null==e||e instanceof r?(this._exceptionCatcher.runProtected("Client.createSession",function(){t=l._sessionFactory.makeVideoSession(e,I.SESSION_TYPE.VIDEO)}),t):(l._logger.error("createSession(): expecting an instance of ContentMetadata for contentMetadata parameter"),t)},this.createAdSession=function(e,t){var i=n.NO_SESSION_KEY;return this._released?i:null==t||t instanceof r?(this._exceptionCatcher.runProtected("Client.createAdSession",function(){var n=l._sessionFactory.getVideoSession(e);null!=n&&(null==t&&(t=new r),null!=t.applicationName&&null!=t.viewerId||(null==t.viewerId&&null!=n._contentMetadata.viewerId&&(t.viewerId=n._contentMetadata.viewerId),null==t.applicationName&&null!=n._contentMetadata.applicationName&&(t.applicationName=n._contentMetadata.applicationName)),t.custom["c3.csid"]=O.ToString(n._id)),i=l._sessionFactory.makeVideoSession(t,I.SESSION_TYPE.AD)}),i):(l._logger.error("createAdSession(): expecting an instance of ContentMetadata for adMetadata parameter"),i)},this.reportError=function(t,n,i){if(!this._released)return O.isValidString(n)?i!==e.Client.ErrorSeverity.FATAL&&i!==e.Client.ErrorSeverity.WARNING?void this._logger.error("reportError(): invalid error severity: "+i):void this._exceptionCatcher.runProtected("Client.reportError",function(){var e=l._sessionFactory.getVideoSession(t);null!=e&&e.reportError(n,i)}):void this._logger.error("reportError(): invalid error message string: "+n)},this.updateContentMetadata=function(e,t){if(!this._released)return t instanceof r?void this._exceptionCatcher.runProtected("Client.updateContentMetadata",function(){var n=l._sessionFactory.getVideoSession(e);if(null!=n){var i=t.clone();n.updateContentMetadata(i)}}):void l._logger.error("updateContentMetadata(): expecting an instance of ContentMetadata for contentMetadata parameter")},this.detachPlayer=function(e){this._released||this._exceptionCatcher.runProtected("Client.detachPlayer",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.detachPlayer()})},this.attachPlayer=function(e,t){if(!this._released)return t instanceof s?void this._exceptionCatcher.runProtected("Client.attachPlayer",function(){var n=l._sessionFactory.getVideoSession(e);null!=n&&n.attachPlayer(t)}):void l._logger.error("attachPlayer(): expecting an instance of PlayerStateManager for playerStateManager parameter")},this.contentPreload=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentPreload",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.contentPreload()})},this.contentStart=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentStart",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.contentStart()})},this.sendCustomEvent=function(e,t,i){if(!this._released)return O.isValidString(t)?void this._exceptionCatcher.runProtected("Client.sendCustomEvent",function(){if(e==n.NO_SESSION_KEY){if(l._globalSessionKey<0){var a=new r;l._globalSessionKey=l._sessionFactory.makeGlobalSession(a,null)}e=l._globalSessionKey}var o=O.sanitizeStringToStringObject(i),s=l._sessionFactory.getSession(e);null!=s&&s.sendCustomEvent(t,o)}):void l._logger.error("sendCustomEvent(): eventName parameter must be a valid string.")},this.adStart=function(e,t,i,r){if(!this._released)return t!==n.AdStream.CONTENT&&t!==n.AdStream.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adStream parameter: "+t):i!==n.AdPlayer.CONTENT&&i!==n.AdPlayer.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adPlayer parameter: "+i):r!==n.AdPosition.BUMPER&&r!==n.AdPosition.PREROLL&&r!==n.AdPosition.MIDROLL&&r!==n.AdPosition.POSTROLL?void this._logger.error("adStart(): ignored, invalid value for adPosition parameter: "+r):void this._exceptionCatcher.runProtected("Client.adStart",function(){var n=l._sessionFactory.getVideoSession(e);null!=n&&n.adStart(t,i,r)})},this.adEnd=function(e){this._released||this._exceptionCatcher.runProtected("Client.adEnd",function(){var t=l._sessionFactory.getVideoSession(e);null!=t&&t.adEnd()})},this.cleanupSession=function(e){if(!this._released)return e===n.NO_SESSION_KEY?void this._logger.warning("cleanupSession(): ignored, can't cleanup Client.NO_SESSION_KEY"):void this._exceptionCatcher.runProtected("Client.cleanupSession",function(){null!=l._sessionFactory.getVideoSession(e)&&l._sessionFactory.cleanupSession(e)})},this.getAttachedPlayer=function(e){var t=null;return this._released?t:e===n.NO_SESSION_KEY?(this._logger.warning("getAttachedPlayer(): ignored for Client.NO_SESSION_KEY"),t):(this._exceptionCatcher.runProtected("Client.getAttachedPlayer",function(){var n=l._sessionFactory.getVideoSession(e);null!=n&&(t=n.getPlayerStateManager())}),t)},this.isPlayerAttached=function(e){return!this._released&&null!==this.getAttachedPlayer(e)},this.getPlayerStateManager=function(){if(this._released)throw new Error("This instance of Conviva.Client has been released.");return new s(this._systemFactory)},this.releasePlayerStateManager=function(e){if(this._released)throw new Error("This instance of Conviva.Client has been released.");this._exceptionCatcher.runProtected("Client.releasePlayerStateManager",function(){e instanceof s&&e.release()})},this.getSettings=function(){return this._settings},this.getId=function(){return this._id},this.setUniqueIdentifier=function(e,t){if(this._released)throw new Error("This instance of Conviva.Client has been released.");if(null==e||void 0===e||"{}"==JSON.stringify(e))throw new Error("Identifiers are not set. No action taken !!");for(var n in e)this._uniqueIdentifiers[n]=e[n];t&&(this._uniqueIdentifierCallback=t)},this.setUserPreferenceForDataCollection=function(e,t){if(this._released)throw new Error("This instance of Conviva.Client has been released.");if(null==e||void 0===e||"{}"==JSON.stringify(e))throw new Error("Identifiers are not set. No action taken !!");for(var n in e)"false"==e[n]?this._userPrefForData[n]=t?N.ConvivaIdErrorCodes.CONVIVAID_PRIVACY_RESTRICTION:N.ConvivaIdErrorCodes.CONVIVAID_USER_OPTOUT:this._userPrefForData[n]=N.ConvivaIdErrorCodes.CONVIVAID_USER_NO_RESTRICTION},this.setUserPreferenceForDataDeletion=function(e){if(this._released)throw new Error("This instance of Conviva.Client has been released.");if(null==e||void 0===e||"{}"==JSON.stringify(e))throw new Error("Identifiers are not set. No action taken !!");for(var t in e)"true"==e[t]?this._userPrefForData[t]=N.ConvivaIdErrorCodes.CONVIVAID_USER_OPT_DELETE:this._userPrefForData[t]=N.ConvivaIdErrorCodes.CONVIVAID_USER_NO_RESTRICTION}};n.version="2.151.0.37023",n.NO_SESSION_KEY=-2,n.AdPosition={BUMPER:"BUMPER",PREROLL:"PREROLL",MIDROLL:"MIDROLL",POSTROLL:"POSTROLL"},n.AdStream={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},n.AdPlayer={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},n.ErrorSeverity={FATAL:0,WARNING:1},n.DeviceType={DESKTOP:"DESKTOP",CONSOLE:"Console",SETTOP:"Settop",MOBILE:"Mobile",TABLET:"Tablet",SMARTTV:"SmartTV"},n.AdTechnology={CLIENT_SIDE:"Client Side",SERVER_SIDE:"Server Side"},n.AdType={BLACKOUT_SLATE:"Blackout slate",TECHNICAL_DIFFICULTIES_SLATE:"Technical Difficulties slate",COMMERCIAL_SLATE:"Commercial Break slate",OTHER_SLATE:"Other slate",VPAID:"VPAID",REGULAR:"Regular Ad"},n.AdServingType={INLINE:"Inline",WRAPPER:"Wrapper"},n.DeviceCategory={ANDROID_DEVICE:"AND",APPLE_DEVICE:"APL",CHROMECAST:"CHR",DESKTOP_APP:"DSKAPP",DEVICE_SIMULATOR:"SIMULATOR",LG_TV:"LGTV",NINTENDO:"NINTENDO",PLAYSTATION:"PS",ROKU:"RK",SAMSUNG_TV:"SAMSUNGTV",SMART_TV:"TV",SET_TOP_BOX:"STB",TIVO:"TIVO",WEB:"WEB",WINDOWS_DEVICE:"WIN",XBOX:"XB",KAIOS_DEVICE:"KAIOS"};var i=e.ClientSettings=function(e){function t(e){if(!O.isValidString(e))throw new Error("customerKey must be valid");this.customerKey=e}function n(e){if(O.isValidString(e)){var t=e.split("://");if("cws.conviva.com"!=t[1]&&("https"==t[0]||"http"==t[0]))return e}return"https://"+r.customerKey+"."+i.defaultProductionGatewayDNS}var r=this;this._customerKey=null,O.defGet(this,"customerKey",function(){return this._customerKey}),O.defSet(this,"customerKey",function(e){O.isValidString(e)&&(this._customerKey=e)}),this._heartbeatInterval=i.defaultProductionHeartbeatInterval,O.defGet(this,"heartbeatInterval",function(){return this._heartbeatInterval}),O.defSet(this,"heartbeatInterval",function(e){if("number"==typeof e){var t=O.NumberToUnsignedInt(e);t===e&&(this._heartbeatInterval=t)}}),this._gatewayUrl=null,O.defGet(this,"gatewayUrl",function(){return this._gatewayUrl}),O.defSet(this,"gatewayUrl",function(e){O.isValidString(e)&&(this._gatewayUrl=e)}),t.apply(this,arguments),this.equals=function(e){return this.customerKey===e.customerKey&&this.gatewayUrl===e.gatewayUrl&&this.heartbeatInterval===e.heartbeatInterval},this.clone=function(){var e=new i(this.customerKey);return e.gatewayUrl=n(this.gatewayUrl),e.heartbeatInterval=this.heartbeatInterval,e}};i.defaultDevelopmentGatewayUrl="https://conviva.testonly.conviva.com",i.defaultProductionGatewayUrl="https://cws.conviva.com",i.defaultProductionGatewayDNS="cws.conviva.com",i.defaultDevelopmentGatewayDNS="conviva.testonly.conviva.com",i._httpsProtocol="https://",i._httpProtocol="http://",i.defaultDevelopmentHeartbeatInterval=5,i.defaultProductionHeartbeatInterval=20;var r=e.ContentMetadata=function(){function e(){return this._assetName}function t(e){"string"==typeof e&&(this._assetName=e)}function n(){return this._custom}function i(e){"object"==typeof e&&(this._custom=O.sanitizeStringToStringObject(e))}function a(){return this._defaultResource}function o(e){"string"==typeof e&&(this._defaultResource=e)}function s(){return this._viewerId}function _(e){"string"==typeof e&&(this._viewerId=e)}function l(){return this._applicationName}function u(e){"string"==typeof e&&(this._applicationName=e)}function c(){return this._streamUrl}function E(e){"string"==typeof e&&(this._streamUrl=e)}function d(){return this._streamType}function g(e){e!==r.StreamType.UNKNOWN&&e!==r.StreamType.VOD&&e!==r.StreamType.LIVE||(this._streamType=e)}function h(){return this._duration}function f(e){this._duration=b.sanitizeSpecialIntegerValue(e)}function S(){return this._encodedFrameRate}function T(e){this._encodedFrameRate=b.sanitizeSpecialIntegerValue(e)}function R(){}this._assetName=null,O.defGet(this,"assetName",e),O.defSet(this,"assetName",t),this._custom={},O.defGet(this,"custom",n),O.defSet(this,"custom",i),this._defaultResource=null,O.defGet(this,"defaultResource",a),O.defSet(this,"defaultResource",o),this._viewerId=null,O.defGet(this,"viewerId",s),O.defSet(this,"viewerId",_),this._applicationName=null,O.defGet(this,"applicationName",l),O.defSet(this,"applicationName",u),this._streamUrl=null,O.defGet(this,"streamUrl",c),O.defSet(this,"streamUrl",E),this._streamType=r.StreamType.UNKNOWN,O.defGet(this,"streamType",d),O.defSet(this,"streamType",g),this._duration=-1,O.defGet(this,"duration",h),O.defSet(this,"duration",f),this._encodedFrameRate=-1,O.defGet(this,"encodedFrameRate",S),O.defSet(this,"encodedFrameRate",T),R.apply(this,arguments),this.clone=function(){var e=new r;e.assetName=this.assetName,e.applicationName=this.applicationName,e.streamUrl=this.streamUrl,e.viewerId=this.viewerId,e.defaultResource=this.defaultResource,e.streamType=this.streamType,e.duration=this.duration,e.encodedFrameRate=this.encodedFrameRate;for(var t in this.custom)e.custom[t]=this.custom[t];return e}};r.StreamType={UNKNOWN:"UNKNOWN",LIVE:"LIVE",VOD:"VOD"};var a=(e.ErrorType={ERROR_UNKNOWN:"ERROR_UNKNOWN",ERROR_IO:"ERROR_IO",ERROR_TIMEOUT:"ERROR_TIMEOUT",ERROR_NULL_ASSET:"ERROR_NULL_ASSET",ERROR_MISSING_PARAMETER:"ERROR_MISSING_PARAMETER",ERROR_NO_AD_AVAILABLE:"ERROR_NO_AD_AVAILABLE",ERROR_PARSE:"ERROR_PARSE",ERROR_INVALID_VALUE:"ERROR_INVALID_VALUE",ERROR_INVALID_SLOT:"ERROR_INVALID_SLOT",ERROR_3P_COMPONENT:"ERROR_3P_COMPONENT",ERROR_UNSUPPORTED_3P_FEATURE:"ERROR_UNSUPPORTED_3P_FEATURE",ERROR_DEVICE_LIMIT:"ERROR_DEVICE_LIMIT",ERROR_UNMATCHED_SLOT_SIZE:"ERROR_UNMATCHED_SLOT_SIZE"},e.Events={AD_REQUESTED:"Conviva.AdRequested",AD_RESPONSE:"Conviva.AdResponse",AD_SLOT_STARTED:"Conviva.SlotStarted",AD_ATTEMPTED:"Conviva.AdAttempted",AD_SLOT_ENDED:"Conviva.SlotEnded",AD_IMPRESSION_START:"Conviva.AdImpression",AD_START:"Conviva.AdStart",AD_FIRST_QUARTILE:"Conviva.AdFirstQuartile",AD_MID_QUARTILE:"Conviva.AdMidQuartile",AD_THIRD_QUARTILE:"Conviva.AdThirdQuartile",AD_COMPLETE:"Conviva.AdComplete",AD_END:"Conviva.AdEnd",AD_IMPRESSION_END:"Conviva.AdImpressionEnd",AD_SKIPPED:"Conviva.AdSkipped",AD_ERROR:"Conviva.AdError",AD_PROGRESS:"Conviva.AdProgress",AD_CLOSE:"Conviva.AdClose",CONTENT_PAUSED:"Conviva.PauseContent",CONTENT_RESUMED:"Conviva.ResumeContent",POD_START:"Conviva.PodStart",POD_END:"Conviva.PodEnd"},e.SystemFactory=function(e,t){function n(e,t){if(!(e instanceof E))throw new Error("systemInterface parameter should be an instance of SystemInterface.");this._systemInterface=e,this._timeInterface=this._systemInterface._timeInterface,this._timerInterface=this._systemInterface._timerInterface,this._httpInterface=this._systemInterface._httpInterface,this._storageInterface=this._systemInterface._storageInterface,this._metadataInterface=this._systemInterface._metadataInterface,this._loggingInterface=this._systemInterface._loggingInterface,this._settings=t instanceof o?t.clone():new o}var i=this;n.apply(this,arguments),this.configure=function(e,t){this._packageName=e,this._clientSettings=t},this.release=function(){this._systemInterface.release(),this._systemInterface=null,this._packageName=null,this._settings=null,this._logBuffer=null};var r={build:function(){return new D(i._loggingInterface,i._timeInterface,i.getSettings(),i._logBuffer,i._packageName)}};this.buildLogger=function(){return r.build()},this.buildSessionFactory=function(e,t,n){return new v(e,t,n,this)},this.buildPing=function(){return new M(this.buildLogger(),this.buildHttpClient(),this._clientSettings)},this.buildCallbackWithTimeout=function(){return new p(this.buildTimer())},this.buildCallbackWithTimeoutNoPing=function(){var e=new A(this.buildLogger(),null,this.getSettings()),t=new K(this.buildLogger(),this._timerInterface,e);return new p(t)},this.buildHttpClient=function(){return new w(this.buildLogger(),this._httpInterface,this.buildCallbackWithTimeoutNoPing(),this.getSettings())},this.buildExceptionCatcher=function(){return new A(this.buildLogger(),this.buildPing(),this.getSettings())},this.buildTime=function(){return new V(this._timeInterface,this.buildLogger())},this.buildTimer=function(){return new K(this.buildLogger(),this._timerInterface,this.buildExceptionCatcher())},this.buildStorage=function(){return new F(this.buildLogger(),this._storageInterface,this.buildCallbackWithTimeout(),this.getSettings())},this.buildConfig=function(){return new N(this.buildLogger(),this.buildStorage(),this.buildJsonInterface())},this.buildSystemMetadata=function(){return new L(this.buildLogger(),this._metadataInterface,this.buildExceptionCatcher())},this.buildCwsProtocol=function(){return new S},this.buildGatewayControl=function(e){return new y(e,this.buildLogger(),this.buildHttpClient(),this.buildJsonInterface())},this.buildCwsSession=function(e,t,n){var i=this.buildGatewayControl(t);return new I(this.buildEventQueue(),e,t,this.buildLogger(),this.buildExceptionCatcher(),this.buildTimer(),i,this.buildCwsProtocol(),this.buildTime(),this.getLogBuffer(),n)},this.buildSession=function(e,t,n,i,r,a){var o=this.buildExceptionCatcher(),s=this.buildLogger(),_=t.clone(),l=this.buildCwsSession(e,_,n);return new m(i,r,a,n,this.buildSystemMetadata(),l,o,s)},this.buildEventQueue=function(){return new C},this.buildJsonInterface=function(){return new T},this.getLogBuffer=function(){return this._logBuffer},this.getSettings=function(){return this._settings},this._logBuffer=new P}),o=e.SystemSettings=function(){function e(){}this._logLevel=o.defaultProductionLogLevel,O.defGet(this,"logLevel",function(){return this._logLevel}),O.defSet(this,"logLevel",function(e){if("number"==typeof e){var t=O.NumberToUnsignedInt(e);t===e&&t>=o.LogLevel.DEBUG&&t<=o.LogLevel.ERROR&&(this._logLevel=t)}}),this._allowUncaughtExceptions=o.defaultProductionAllowUncaughtExceptions,O.defGet(this,"allowUncaughtExceptions",function(){return this._allowUncaughtExceptions}),O.defSet(this,"allowUncaughtExceptions",function(e){O.isBoolean(e)&&(this._allowUncaughtExceptions=e)}),this._storageTimeout=o.defaultStorageTimeout,O.defGet(this,"storageTimeout",function(){return this._storageTimeout}),O.defSet(this,"storageTimeout",function(e){if("number"==typeof e){var t=O.NumberToUnsignedInt(e);t===e&&(this._storageTimeout=t)}}),this._httpTimeout=o.defaultHttpTimeout,O.defGet(this,"httpTimeout",function(){return this._httpTimeout}),O.defSet(this,"httpTimeout",function(e){if("number"==typeof e){var t=O.NumberToUnsignedInt(e);t===e&&(this._httpTimeout=t)}}),e.apply(this,arguments),this.equals=function(e){return this.logLevel===e.logLevel&&this.allowUncaughtExceptions===e.allowUncaughtExceptions&&this.storageTimeout===e.storageTimeout&&this.httpTimeout===e.httpTimeout},this.clone=function(){var e=new o;return e.logLevel=this.logLevel,e.allowUncaughtExceptions=this.allowUncaughtExceptions,e.storageTimeout=this.storageTimeout,e.httpTimeout=this.httpTimeout,e}};o.LogLevel={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},o.defaultDevelopmentLogLevel=o.LogLevel.DEBUG,o.defaultProductionLogLevel=o.LogLevel.ERROR,o.defaultDevelopmentAllowUncaughtExceptions=!0,o.defaultProductionAllowUncaughtExceptions=!1,o.defaultStorageTimeout=10,o.defaultHttpTimeout=10;var s=e.PlayerStateManager=function(n){function i(e){r._systemFactory=e,r._logger=r._systemFactory.buildLogger(),r._logger.setModuleName("PlayerStateManager"),r._exceptionCatcher=r._systemFactory.buildExceptionCatcher()}var r=this;r._monitorNotifier=null,r._bitrateKbps=-2,r._playerState=s.PlayerState.UNKNOWN,r._currentMetadata={},r._renderedFrameRate=-2,r._encodedFrameRate=-2,r._duration=-2,r._playerVersion=null,r._playerType=null,r._streamUrl=null,r._moduleName=null,r._moduleVersion=null,r._width=-1,r._height=-1,r._connectionType=null,r._linkEncryption=null,r._lastError=null,r._pendingErrors=[],r._released=!1,this.release=function(){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.release",function(){null!=r._monitorNotifier&&r._monitorNotifier.onRelease(),r.removeMonitoringNotifier(),r._systemFactory=null,r._logger=null,r._exceptionCatcher=null,r._released=!0})},this.setPlayheadTime=function(e){},this.setBufferLength=function(e){},this.setRenderedFrameRate=function(e){},this.getEncodedFrameRate=function(){return r._encodedFrameRate},this.setEncodedFrameRate=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setEncodedFrameRate",function(){var t=b.sanitizeSpecialIntegerValue(e);t>=-1&&(r._encodedFrameRate=t,null!=r._monitorNotifier&&r._monitorNotifier.onEncodedFrameRateChange(r._encodedFrameRate))})},this.getDuration=function(){return r._duration},this.setClientMeasureInterface=function(t){O.validateInterface(t,new e.ClientMeasureInterface,"ClientMeasureInterface"),this._playerInterface=t},this.getPHT=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getPHT?this._playerInterface.getPHT():s.DEFAULT_PHT},this.getBufferLength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getBufferLength?this._playerInterface.getBufferLength():s.DEFAULT_BUFFER_LENGTH},this.getSignalStrength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getSignalStrength?this._playerInterface.getSignalStrength():s.DEFAULT_SIGNAL_STRENGTH},this.getRenderedFrameRate=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getRenderedFrameRate?this._playerInterface.getRenderedFrameRate():s.DEFAULT_RENDERED_FRAME_RATE},this.setDuration=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setDuration",function(){var t=b.sanitizeSpecialIntegerValue(e);t>=-1&&(r._duration=t,null!=r._monitorNotifier&&r._monitorNotifier.onContentLengthChange(r._duration))})},this.getStreamUrl=function(){return r._streamUrl},this.setStreamUrl=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setStreamUrl",function(){null!=e&&(r._streamUrl=e,null!=r._monitorNotifier&&r._monitorNotifier.onStreamUrlChange(r._streamUrl))})},this.getModuleName=function(){return r._moduleName},this.getModuleVersion=function(){return r._moduleVersion},this.setModuleNameAndVersion=function(e,t){r._moduleName=e,r._moduleVersion=t},this.getPlayerType=function(){return r._playerType},this.setPlayerType=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setPlayerType",function(){r._playerType=e,null!=r._monitorNotifier&&r._monitorNotifier.onPlayerTypeChange(r._playerType)})},this.getPlayerVersion=function(){return r._playerVersion},this.setPlayerVersion=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setPlayerVersion",function(){r._playerVersion=e,null!=r._monitorNotifier&&r._monitorNotifier.onPlayerVersionChange(r._playerVersion)})},this.setMonitoringNotifier=function(e,t){if(!r._released)return null==r._monitorNotifier&&(r._monitorNotifier=e,r._logger.setSessionId(t),!0)},this.removeMonitoringNotifier=function(){r._released||(r._monitorNotifier=null,r._logger.setSessionId(null))},this.pushCurrentState=function(){r.setPlayerState(r.getPlayerState()),r.setBitrateKbps(r.getBitrateKbps()),r.setDuration(r.getDuration()),r.setEncodedFrameRate(r.getEncodedFrameRate()),r.setStreamUrl(r.getStreamUrl()),r.setPlayerType(r.getPlayerType()),r.setPlayerVersion(r.getPlayerVersion());for(var e=0;e<r._pendingErrors.length;e++){var t=r._pendingErrors[e];r.setError(t)}r._pendingErrors=[]},this.getPlayerState=function(){return r._playerState},this.setPlayerState=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setPlayerState",function(){s.isValidPlayerState(e)?(r._playerState=e,null!=r._monitorNotifier&&r._monitorNotifier.onPlayerStateChange(r._playerState)):r._logger.error("PlayerStateManager.SetPlayerState(): invalid state: "+e)})},this.getBitrateKbps=function(){return r._bitrateKbps},this.setBitrateKbps=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setBitrateKbps",function(){var t=b.sanitizeSpecialIntegerValue(e);t>=-1&&(r._bitrateKbps=t,null!=r._monitorNotifier&&r._monitorNotifier.onBitrateChange(r._bitrateKbps))})},this.setPlayerSeekStart=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekStart()",function(){null!=r._monitorNotifier&&r._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.SEEK_START,e)})},this.setPlayerSeekEnd=function(){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekEnd()",function(){null!=r._monitorNotifier&&r._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.SEEK_END,-1)})},this.setUserSeekButtonUp=function(){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonUp()",function(){null!=r._monitorNotifier&&r._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.BUTTON_UP,-1)})},this.setUserSeekButtonDown=function(){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonDown()",function(){null!=r._monitorNotifier&&r._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.BUTTON_DOWN,-1)})},this.setVideoResolutionWidth=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionWidth()",function(){var t=b.sanitizeSpecialIntegerValue(e);t>0&&(r._width=t),null!=r._monitorNotifier&&r._monitorNotifier.onStreamResolutionWidthChange(r._width)})},this.setVideoResolutionHeight=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionHeight()",function(){var t=b.sanitizeSpecialIntegerValue(e);t>0&&(r._height=t),null!=r._monitorNotifier&&r._monitorNotifier.onStreamResolutionHeightChange(r._height)})},this.setConnectionType=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setConnectionType()",function(){r._connectionType=e,null!=r._monitorNotifier&&r._monitorNotifier.onConnectionTypeChange(r._connectionType)})},this.setLinkEncryption=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setLinkEncryption()",function(){r._linkEncryption=e,null!=r._monitorNotifier&&r._monitorNotifier.onLinkEncryptionChange(r._linkEncryption)})},this.setSignalStrength=function(e){},this.setError=function(e){if(r._lastError=e,null!=r._monitorNotifier){var t=e.errorCode,n=e.severity;r._monitorNotifier.onError(t,n)}else r._pendingErrors.push(e)},this.sendError=function(e,n){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.sendError",function(){var i=new t.StreamerError(e,n);r.setError(i)})},this.reset=function(){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.reset",function(){r._bitrateKbps=-2,r._playerState=s.PlayerState.UNKNOWN,r._currentMetadata={},r._renderedFrameRate=-1,r._encodedFrameRate=-1,r._duration=-1,r._playerVersion=null,r._playerType=null,r._streamUrl=null,r._lastError=null,r._pendingErrors=[]})},this.setCDNServerIP=function(e){r._released||r._exceptionCatcher.runProtected("PlayerStateManager.setCDNServerIP",function(){null!=r._monitorNotifier&&r._monitorNotifier.onCDNServerIPChange(e)})},this.getError=function(){return r._lastError},i.apply(r,arguments),s.DEFAULT_SIGNAL_STRENGTH=1e3,s.DEFAULT_RENDERED_FRAME_RATE=-1,s.DEFAULT_BUFFER_LENGTH=-1,s.DEFAULT_PHT=-1};s.PlayerState={STOPPED:"STOPPED",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED",UNKNOWN:"UNKNOWN",NOT_MONITORED:"NOT_MONITORED"},s.isValidPlayerState=function(e){return e===s.PlayerState.STOPPED||e===s.PlayerState.PLAYING||e===s.PlayerState.BUFFERING||e===s.PlayerState.PAUSED||e===s.PlayerState.UNKNOWN||e===s.PlayerState.NOT_MONITORED},s.SEEK_ACTIONS_TYPE={SEEK_START:"pss",SEEK_END:"pse",BUTTON_UP:"bu",BUTTON_DOWN:"bd"};var _=(e.ClientMeasureInterface=function(){this.getPHT=function(){},this.getBufferLength=function(){},this.getSignalStrength=function(){},this.getRenderedFrameRate=function(){}},e.HttpInterface=function(){this.makeRequest=function(e,t,n,i,r,a){},this.release=function(){}}),l=e.LoggingInterface=function(){this.consoleLog=function(e,t){},this.release=function(){}},u=e.MetadataInterface=function(){this.getBrowserName=function(){},this.getBrowserVersion=function(){},this.getDeviceBrand=function(){},this.getDeviceManufacturer=function(){},this.getDeviceModel=function(){},this.getDeviceType=function(){},this.getDeviceVersion=function(){},this.getFrameworkName=function(){},this.getFrameworkVersion=function(){},this.getOperatingSystemName=function(){},this.getOperatingSystemVersion=function(){},this.getDeviceCategory=function(){},this.release=function(){}},c=e.StorageInterface=function(){this.saveData=function(e,t,n,i){},this.loadData=function(e,t,n){},this.release=function(){}},E=e.SystemInterface=function(e,t,n,i,r,a){function o(e,t,n,i,r,a){O.validateInterface(e,new d,"TimeInterface"),O.validateInterface(t,new g,"TimerInterface"),O.validateInterface(n,new _,"HttpInterface"),O.validateInterface(i,new c,"StorageInterface"),O.validateInterface(r,new u,"MetadataInterface"),O.validateInterface(a,new l,"LoggingInterface"),this._timeInterface=e,this._timerInterface=t,this._httpInterface=n,this._storageInterface=i,this._metadataInterface=r,this._loggingInterface=a}o.apply(this,arguments),this.release=function(){this._timeInterface.release(),this._timeInterface=null,this._timerInterface.release(),this._timerInterface=null,this._httpInterface.release(),this._httpInterface=null,this._storageInterface.release(),this._storageInterface=null,this._metadataInterface.release(),this._metadataInterface=null,this._loggingInterface.release(),this._loggingInterface=null}},d=e.TimeInterface=function(){this.getEpochTimeMs=function(){},this.release=function(){}},g=e.TimerInterface=function(){this.createTimer=function(e,t,n){},this.release=function(){}},h=t.JSON2={};!function(){function e(e){return e<10?"0"+e:e}function t(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,function(e){var t=o[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function n(e,i){var o,_,l,u,c,E=r,d=i[e];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(e)),"function"==typeof s&&(d=s.call(i,e,d)),typeof d){case"string":return t(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(r+=a,c=[],Object.prototype.toString.apply(d)===Object.prototype.toString.apply([])){for(u=d.length,o=0;o<u;o+=1)c[o]=n(o,d)||"null";return l=0===c.length?"[]":r?"[\n"+r+c.join(",\n"+r)+"\n"+E+"]":"["+c.join(",")+"]",r=E,l}if(s&&"object"==typeof s)for(u=s.length,o=0;o<u;o+=1)"string"==typeof s[o]&&(_=s[o],(l=n(_,d))&&c.push(t(_)+(r?": ":":")+l));else for(_ in d)Object.prototype.hasOwnProperty.call(d,_)&&(l=n(_,d))&&c.push(t(_)+(r?": ":":")+l);return l=0===c.length?"{}":r?"{\n"+r+c.join(",\n"+r)+"\n"+E+"}":"{"+c.join(",")+"}",r=E,l}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var i,r,a,o,s;"function"!=typeof h.stringify&&(i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h.stringify=function(e,t,i){var o;if(r="",a="","number"==typeof i)for(o=0;o<i;o+=1)a+=" ";else"string"==typeof i&&(a=i);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON2.stringify");return n("",{"":e})})}();var f=t.JsonParse=function(){var e,t,n,i,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},a=function(t){throw{name:"SyntaxError",message:t,at:e,text:n}},o=function(i){return i&&i!==t&&a("Expected '"+i+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t},s=function(){var e,n="";for("-"===t&&(n="-",o("-"));t>="0"&&t<="9";)n+=t,o();if("."===t)for(n+=".";o()&&t>="0"&&t<="9";)n+=t;if("e"===t||"E"===t)for(n+=t,o(),"-"!==t&&"+"!==t||(n+=t,o());t>="0"&&t<="9";)n+=t,o();if(e=+n,!isNaN(e))return e;a("Bad number")},_=function(){var e,n,i,s="";if('"'===t)for(;o();){if('"'===t)return o(),s;if("\\"===t)if(o(),"u"===t){for(i=0,n=0;n<4&&(e=parseInt(o(),16),isFinite(e));n+=1)i=16*i+e;s+=String.fromCharCode(i)}else{if("string"!=typeof r[t])break;s+=r[t]}else s+=t}a("Bad string")},l=function(){for(;t&&t<=" ";)o()},u=function(){switch(t){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}a("Unexpected '"+t+"'")},c=function(){var e=[];if("["===t){if(o("["),l(),"]"===t)return o("]"),e;for(;t;){if(e.push(i()),l(),"]"===t)return o("]"),e;o(","),l()}}a("Bad array")},E=function(){var e,n={};if("{"===t){if(o("{"),l(),"}"===t)return o("}"),n;for(;t;){if(e=_(),l(),o(":"),Object.hasOwnProperty.call(n,e)&&a('Duplicate key "'+e+'"'),n[e]=i(),l(),"}"===t)return o("}"),n;o(","),l()}}a("Bad object")};return i=function(){switch(l(),t){case"{":return E();case"[":return c();case'"':return _();case"-":return s();default:return t>="0"&&t<="9"?s():u()}},function(r,o){var s;return n=r,e=0,t=" ",s=i(),l(),t&&a("Syntax error"),"function"==typeof o?function e(t,n){var i,r,a=t[n];if(a&&"object"==typeof a)for(i in a)Object.hasOwnProperty.call(a,i)&&(r=e(a,i),void 0!==r?a[i]=r:delete a[i]);return o.call(t,n,a)}({"":s},""):s}}(),S=t.CwsProtocol=function(){this.generateEvent=function(e,t,n,i){return i.seq=e,i.st=t,i.t=n,i},this.generateSessionEndEvent=function(e,t){var n=S.EVENT_TYPE_SESSION_END,i={};return this.generateEvent(e,t,n,i)}};S.version="2.6",S.gatewayPath="/0/wsg",S.DEFAULT_CLIENT_ID="0",S.DEFAULT_MAX_HEARTBEAT_INFOS=0,S.DEFAULT_PLAYHEAD_TIME=-1,S.DEFAULT_BUFFER_LENGTH=-1,S.DEFAULT_SIGNAL_STRENGTH=1e3,S.SDK_METADATA_SCHEMA="sdk.js.1",S.EVENT_TYPE_STATE_CHANGE="CwsStateChangeEvent",S.EVENT_TYPE_ERROR="CwsErrorEvent",S.EVENT_TYPE_SESSION_END="CwsSessionEndEvent",S.EVENT_TYPE_CUSTOM="CwsCustomEvent",S.EVENT_TYPE_SEEK="CwsSeekEvent",S.EVENT_TYPE_DATA_SAMPLE="CwsDataSamplesEvent",S.RESPONSE_STATUS_NO_ERRORS="ok",S.RESPONSE_KEY_STATUS="err",S.RESPONSE_KEY_CLIENT_ID="clid",S.RESPONSE_KEY_CONFIG="cfg",S.RESPONSE_KEY_EVENTS="evs",S.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxhbinfos",S.RESPONSE_CONFIG_KEY_SEND_LOGS="slg",S.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL="hbi",S.RESPONSE_CONFIG_KEY_GATEWAY_URL="gw",S.RESPONSE_CONFIG_KEY_CONVIVAID_FP="fp",S.MESSAGE_TYPE_SESSION_HEARTBEAT="CwsSessionHb",S.REQUEST_KEY_MESSAGE_TYPE="t",S.REQUEST_KEY_SESSION_TIME="st",S.REQUEST_KEY_SESSION_START_TIME="sst",S.REQUEST_KEY_IS_LIVE="lv",S.REQUEST_KEY_SEQUENCE_NUMBER="seq",S.REQUEST_KEY_CUSTOMER_KEY="cid",S.REQUEST_KEY_CLIENT_ID="clid",S.REQUEST_KEY_CLIENT_VERSION="clv",S.REQUEST_KEY_PROTOCOL_VERSION="pver",S.REQUEST_KEY_INSTANCE_ID="iid",S.REQUEST_KEY_SESSION_ID="sid",S.REQUEST_KEY_VIEWER_ID="vid",S.REQUEST_KEY_ASSET_NAME="an",S.REQUEST_KEY_PLAYER_NAME="pn",S.REQUEST_KEY_TAGS="tags",S.REQUEST_KEY_SESSION_FLAGS="sf",S.REQUEST_KEY_EVENTS="evs",S.REQUEST_KEY_LOGS="lg",S.REQUEST_KEY_HEARTBEAT_INFOS="hbinfos",S.REQUEST_KEY_IS_SDK_CLIENT="sdk",S.REQUEST_KEY_PAUSE_JOIN="pj",S.REQUEST_KEY_PLAYER_STATE="ps",S.REQUEST_KEY_BITRATE="br",S.REQUEST_KEY_CONTENT_LENGTH="cl",S.REQUEST_KEY_ENCODED_FRAME_RATE="efps",S.REQUEST_KEY_AVERAGE_FRAME_RATE="afps",S.REQUEST_KEY_RFPS_TOTAL="rfpstot",S.REQUEST_KEY_RFPS_COUNT="rfpscnt",S.REQUEST_KEY_RESOURCE="rs",S.REQUEST_KEY_PLAYHEAD_TIME="pht",S.REQUEST_KEY_BUFFER_LENGTH="bl",S.REQUEST_KEY_STREAM_URL="url",S.REQUEST_KEY_CAPABILITIES="caps",S.REQUEST_KEY_PLATFORM_METADATA="pm",S.REQUEST_KEY_VIDEO_WIDTH="w",S.REQUEST_KEY_VIDEO_HEIGHT="h",S.REQUEST_KEY_CONNECTION_TYPE="ct",S.REQUEST_KEY_LINK_ENCRYPTION="le",S.REQUEST_KEY_SIGNAL_STRENGTH="ss",S.REQUEST_KEY_STREAM_METADATA_CHANGE="strmetadata",S.REQUEST_PLATFORM_METADATA_KEY_SCHEMA="sch",S.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME="br",S.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION="brv",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND="dvb",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER="dvma",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL="dvm",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE="dvt",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION="dvv",S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME="fw",S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION="fwv",S.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION="cc",S.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME="mn",S.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION="mv",S.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME="os",S.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION="osv",S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY="cat",S.REQUEST_KEY_PROTOCOL_CAPP="caps",S.REQUEST_EVENT_KEY_TYPE="t",S.REQUEST_EVENT_KEY_SEQUENCE_NUMBER="seq",S.REQUEST_EVENT_KEY_SESSION_TIME="st",S.REQUEST_EVENT_KEY_SEEK_ACT_TYPE="act",S.REQUEST_EVENT_KEY_SEEK_TO_POS="skto",S.REQUEST_ERROR_EVENT_KEY_MESSAGE="err",S.REQUEST_ERROR_EVENT_KEY_FATAL="ft",S.REQUEST_STATE_CHANGE_EVENT_KEY_NEW="new",S.REQUEST_STATE_CHANGE_EVENT_KEY_OLD="old",S.REQUEST_CUSTOM_EVENT_KEY_NAME="name",S.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES="attr",S.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER="seq",S.REQUEST_HEARTBEAT_INFO_KEY_STATUS="err",S.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME="rtt",S.REQUEST_KEY_IS_AD_SESSION="ad",S.REQUEST_CDN_SERVER_IP="csi",S.convertPlayerState=function(e){switch(e){case s.PlayerState.STOPPED:return S.eStopped;case s.PlayerState.PLAYING:return S.ePlaying;case s.PlayerState.BUFFERING:return S.eBuffering;case s.PlayerState.PAUSED:return S.ePaused;case s.PlayerState.NOT_MONITORED:return S.eNotMonitored;default:return S.eUnknown}},S.eStopped=1,S.ePlaying=3,S.eBuffering=6,S.ePaused=12,S.eNotMonitored=98,S.eUnknown=100,S.SessionFlags={GLOBAL:0,VIDEO:1,QUALITY_METRICS:2,BITRATE_METRICS:4},S.Capabilities={INSIGHTS:0};var T=(t.JSONInterface=function(){this.encode=function(e){},this.decode=function(e){}},t.LibJSONInterface=function(){this.encode=function(e){var t=null;try{t=h.stringify(e)}catch(e){}return t},this.decode=function(e){var t=null;try{t=f(e)}catch(e){}return O.isObject(t)||(t=null),t}}),R=t.CwsHeartbeat=function(){function e(){}this._data={},e.apply(this,arguments),this.get=function(){return this._data},this.setField=function(e,t){this._data[e]=t},this.setInnerField=function(e,t,n){this._data[e]||(this._data[e]={}),this._data[e][t]=n},this.setMessageType=function(e){this.setField(S.REQUEST_KEY_MESSAGE_TYPE,e)},this.setSessionTime=function(e){this.setField(S.REQUEST_KEY_SESSION_TIME,e)},this.setSessionStartTime=function(e){this.setField(S.REQUEST_KEY_SESSION_START_TIME,e)},this.setIsLive=function(e){this.setField(S.REQUEST_KEY_IS_LIVE,e)},this.setSequenceNumber=function(e){this.setField(S.REQUEST_KEY_SEQUENCE_NUMBER,e)},this.setCustomerKey=function(e){this.setField(S.REQUEST_KEY_CUSTOMER_KEY,e)},this.setClientId=function(e){this.setField(S.REQUEST_KEY_CLIENT_ID,e)},this.setClientVersion=function(e){this.setField(S.REQUEST_KEY_CLIENT_VERSION,e)},this.setProtocolVersion=function(e){this.setField(S.REQUEST_KEY_PROTOCOL_VERSION,e)},this.setCapfield=function(e){this.setField(S.REQUEST_KEY_PROTOCOL_CAPP,e)},this.setSessionId=function(e){this.setField(S.REQUEST_KEY_SESSION_ID,e)},this.setInstanceId=function(e){this.setField(S.REQUEST_KEY_INSTANCE_ID,e)},this.setViewerId=function(e){this.setField(S.REQUEST_KEY_VIEWER_ID,e)},this.setAssetName=function(e){this.setField(S.REQUEST_KEY_ASSET_NAME,e)},this.setPlayerName=function(e){this.setField(S.REQUEST_KEY_PLAYER_NAME,e)},this.setTags=function(e){this.setField(S.REQUEST_KEY_TAGS,e)},this.setSessionFlags=function(e){this.setField(S.REQUEST_KEY_SESSION_FLAGS,e)},this.setCapabilities=function(e){this.setField(S.REQUEST_KEY_CAPABILITIES,e)},this.setEvents=function(e){this.setField(S.REQUEST_KEY_EVENTS,e)},this.setIsSdkClient=function(e){this.setField(S.REQUEST_KEY_IS_SDK_CLIENT,e)},this.setLogs=function(e){this.setField(S.REQUEST_KEY_LOGS,e)},this.setHeartbeatInfos=function(e){this.setField(S.REQUEST_KEY_HEARTBEAT_INFOS,e)},this.setPlayerState=function(e){this.setField(S.REQUEST_KEY_PLAYER_STATE,e)},this.setPauseJoin=function(e){this.setField(S.REQUEST_KEY_PAUSE_JOIN,e)},this.setContentLength=function(e){this.setField(S.REQUEST_KEY_CONTENT_LENGTH,e)},this.setBitrate=function(e){this.setField(S.REQUEST_KEY_BITRATE,e)},this.setResource=function(e){this.setField(S.REQUEST_KEY_RESOURCE,e)},this.setEncodedFrameRate=function(e){this.setField(S.REQUEST_KEY_ENCODED_FRAME_RATE,e)},this.setAverageFrameRate=function(e){this.setField(S.REQUEST_KEY_AVERAGE_FRAME_RATE,e)},this.setRfpsObservationCount=function(e){this.setField(S.REQUEST_KEY_RFPS_COUNT,e)},this.setRfpsTotal=function(e){this.setField(S.REQUEST_KEY_RFPS_TOTAL,e)},this.setPlatformMetadataSchema=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_SCHEMA,e)},this.setBrowserName=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME,e)},this.setBrowserVersion=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION,e)},this.setDeviceBrand=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND,e)},this.setDeviceManufacturer=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER,e)},this.setDeviceModel=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL,e)},this.setDeviceType=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE,e)},this.setDeviceVersion=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION,e)},this.setFrameworkName=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e),this.setField(S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e)},this.setFrameworkVersion=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e),this.setField(S.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e)},this.setOperatingSystemName=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME,e.toUpperCase())},this.setOperatingSystemVersion=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION,e)},this.setDeviceCategory=function(e){this.setInnerField(S.REQUEST_KEY_PLATFORM_METADATA,S.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY,e)},this.setPlayheadTime=function(e){this.setField(S.REQUEST_KEY_PLAYHEAD_TIME,e)},this.setBufferLength=function(e){this.setField(S.REQUEST_KEY_BUFFER_LENGTH,e)},this.setStreamUrl=function(e){this.setField(S.REQUEST_KEY_STREAM_URL,e)},this.setStreamWidth=function(e){this.setField(S.REQUEST_KEY_VIDEO_WIDTH,e)},this.setStreamHeight=function(e){this.setField(S.REQUEST_KEY_VIDEO_HEIGHT,e)},this.setConnectionType=function(e){this.setField(S.REQUEST_KEY_CONNECTION_TYPE,e)},this.setLinkEncryption=function(e){this.setField(S.REQUEST_KEY_LINK_ENCRYPTION,e)},this.setIsAdSession=function(){this.setField(S.REQUEST_KEY_IS_AD_SESSION,!0)},this.setSignalStrength=function(e){this.setField(S.REQUEST_KEY_SIGNAL_STRENGTH,e)},this.setModuleName=function(e){this.setInnerField(S.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,S.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME,e)},this.setModuleVersion=function(e){this.setInnerField(S.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,S.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION,e)},this.setCDNServerIP=function(e){this.setField(S.REQUEST_CDN_SERVER_IP,e)}},I=t.CwsSession=function(e,t,i,r,a,o,_,l,u,c,E){function d(e,t,n,i,r,a,o,s,_,l,u){this._eventQueue=e,this._client=t,this._clientSettings=n,this._logger=i,this._logger.setModuleName("CwsSession"),this._exceptionCatcher=r,this._timer=a,this._gatewayControl=o,this._cwsProtocol=s,this._time=_,this._logBuffer=l,this._clientConfig=u}var g=this;g._heartbeatTimerCancel=null,g._startTimeMs=0,g._heartbeatSequenceNumber=0,g._sessionFlags=S.SessionFlags.GLOBAL,g._capabilities=S.Capabilities.INSIGHTS,g._heartbeatInfos=[],g._lastRequestSentMs=-1,g._bitrateKbps=-2,g._resource=null,g._playerState=s.PlayerState.NOT_MONITORED,g._encodedFrameRate=-1,g._contentLengthSec=-1,g._streamUrl=null,g._width=-1,g._height=-1,g._playerStateManager=null,g._assetName=null,g._viewerId=null,g._playerName=null,g._isLive=null,g._tags={},g._browserName=null,g._browserVersion=null,g._deviceBrand=null,g._deviceManufacturer=null,g._deviceModel=null,g._deviceType=null,g._deviceVersion=null,g._frameworkName=null,g._frameworkVersion=null,g._operatingSystemName=null,g._operatingSystemVersion=null,g._deviceCategory=null,g._moduleName=null,g._moduleVersion=null,g._connectionType=null,g._linkEncryption=null,g._cdnServerIP=null,g._pauseJoin=!1,g._hasJoined=!1,g._cleanedUp=!1,g._willEndSoon=!1,g._rfpsTimerCancel=null,g._rfpsTimerInterval=1e3,g._playingFpsObservationCount=0,g._playingFpsTotal=0,g.whitelistedIdentifiers={},g._uniqueIdentifiers={},g._startConvivaIdCollection=!1,d.apply(this,arguments),this.cleanup=function(){this._clientConfig=null,this._logBuffer=null,this._systemSettings=null,this._time=null,this._cwsProtocol=null,this._gatewayControl=null,this._timer=null,this._exceptionCatcher=null,this._logger=null,this._clientSettings=null,this._client=null,this._eventQueue.flush(),this._eventQueue=null,this._cleanedUp=!0},this.start=function(e){this._session=e,this._global=this._session._global,this._logger.setSessionId(this._session._id),this._startTimeMs=this._time.current(),(this.isVideoSession()||this.isAdSession())&&(this._sessionFlags+=I.DEFAULT_VIDEO_SESSION_FLAGS)},this.willEndSoon=function(){this._willEndSoon=!0},this.initialize=function(){this._logger.debug("initialize()")},this.end=function(){(this.isVideoSession()||this.isAdSession())&&(this._logger.debug("end(): schedule the last hb before session cleanup"+g.sessionTypeTag()),this.enqueueSessionEndEvent()),this.cancelHeartbeatTimer(),this.sendHeartbeat()},this.startSendingHeartbeats=function(){this._willEndSoon||(this.sendHeartbeat(),this.resetHeartbeatTimer())},this.setBrowserName=function(e){g._logger.debug("setBrowserName(): "+e);var t=g._browserName;t!==e&&null!=e&&(g._logger.debug("Change browserName from "+t+" to "+e),g._browserName=e)},this.setBrowserVersion=function(e){g._logger.debug("setBrowserVersion(): "+e);var t=g._browserVersion;t!==e&&null!=e&&(g._logger.debug("Change browserVersion from "+t+" to "+e),g._browserVersion=e)},this.setDeviceBrand=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceBrand;t!==e&&null!=e&&(g._logger.debug("Change deviceBrand from "+t+" to "+e),g._deviceBrand=e)},this.setDeviceManufacturer=function(e){g._logger.debug("setDeviceManufacturer(): "+e);var t=g._deviceManufacturer;t!==e&&null!=e&&(g._logger.debug("Change deviceManufacturer from "+t+" to "+e),g._deviceManufacturer=e)},this.setDeviceModel=function(e){g._logger.debug("setDeviceModel(): "+e);var t=g._deviceModel;t!==e&&null!=e&&(g._logger.debug("Change deviceModel from "+t+" to "+e),g._deviceModel=e)},this.setDeviceType=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceType;t!==e&&null!=e&&(g._logger.debug("Change deviceType from "+t+" to "+e),g._deviceType=e)},this.setDeviceVersion=function(e){g._logger.debug("setDeviceVersion(): "+e);var t=g._deviceVersion;t!==e&&null!=e&&(g._logger.debug("Change deviceVersion from "+t+" to "+e),g._deviceVersion=e)},this.setOperatingSystemName=function(e){g._logger.debug("setOperatingSystemName(): "+e);var t=g._operatingSystemName;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemName from "+t+" to "+e),g._operatingSystemName=e)},this.setOperatingSystemVersion=function(e){g._logger.debug("setOperatingSystemVersion(): "+e);var t=g._operatingSystemVersion;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemVersion from "+t+" to "+e),g._operatingSystemVersion=e)},this.setDeviceCategory=function(e){g._logger.debug("setDeviceCategory(): "+e);var t=g._deviceCategory;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemVersion from "+t+" to "+e),g._deviceCategory=e)},this.getFrameworkName=function(){return g._frameworkName},this.setFrameworkName=function(e){g._logger.debug("setFrameworkName(): "+e);var t=g._frameworkName;t!==e&&null!=e&&(g._logger.debug("Change frameworkName from "+t+" to "+e),g._frameworkName=e)},this.getFrameworkVersion=function(){return g._frameworkVersion},this.setFrameworkVersion=function(e){g._logger.debug("setFrameworkVersion(): "+e);var t=g._frameworkVersion;t!==e&&null!=e&&(g._logger.debug("Change frameworkVersion from "+t+" to "+e),g._frameworkVersion=e)},this.setStreamUrl=function(e){g._logger.debug("setStreamUrl(): "+e);var t=g._streamUrl;t!==e&&null!=e&&(g._logger.debug("Change stream url from "+t+" to "+e),g._streamUrl=e)},this.setBitrateKbps=function(e){g._logger.debug("setBitrateKbps(): "+e);var t=g._bitrateKbps;t!==e&&e>0&&(g._logger.info("Change bitrate from "+t+" to "+e),g.enqueueBitrateChangeEvent(t,e),g._bitrateKbps=e)},this.setResource=function(e){g._logger.debug("setResource(): "+e);var t=g._resource;t!==e&&null!=e&&(g._logger.info("Change resource from "+t+" to "+e),g._resource=e)},this.setAssetName=function(e){g._logger.debug("setAssetName(): "+e),g._assetName!==e&&null!=e&&(g._logger.info("Change assetName from "+g._assetName+" to "+e),g._assetName=e)},this.setIsLive=function(e){g._logger.debug("setIsLive(): "+e);var t=g._isLive;t!==e&&null!=e&&(g._logger.info("Change isLive from "+t+" to "+e),g._isLive=e)},this.setViewerId=function(e){g._logger.debug("setViewerId(): "+e);var t=g._viewerId;t!==e&&null!=e&&(g._logger.info("Change viewerId from "+t+" to "+e),g._viewerId=e)},this.setPlayerName=function(e){g._logger.debug("setPlayerName(): "+e);var t=g._playerName;t!==e&&null!=e&&(g._logger.info("Change playerName from "+t+" to "+e),g._playerName=e)},this.setTags=function(e){g._logger.debug("setTags()");var t=g._tags;O.ObjectShallowEquals(t,e)||null==e||(g._logger.info("Change tags from "+O.ObjectToString(t)+" to "+O.ObjectToString(e)),g._tags=e)},this.setEncodedFrameRate=function(e){g._logger.debug("setEncodedFrameRate(): "+e),g._encodedFrameRate=e},this.setContentLength=function(e){g._logger.debug("setContentLength(): "+e),g._contentLengthSec=e},this.setPlayerState=function(e){if(g._logger.debug("setPlayerState(): "+e),g._hasJoined||e!=s.PlayerState.PLAYING||(g.togglePauseJoin(!1),g._hasJoined=!0),g._playerState!==e){var t=g._playerState;g._logger.info("setPlayerState(): changing player state from "+t+" to "+e),g.enqueuePlayerStateChangeEvent(t,e),g._playerState=e}},this.setStreamResolutionWidth=function(e){g._logger.debug("setStreamResolutionWidth(): "+e);var t=g._width;t!==e&&e>0&&(g._logger.debug("Change stream resolution width from "+t+" to "+e),g.enqueueResolutionWidthChangeEvent(t,e),g._width=e)},this.setStreamResolutionHeight=function(e){g._logger.debug("setStreamResolutionHeight(): "+e);var t=g._height;t!==e&&e>0&&(g._logger.debug("Change stream resolution height from "+t+" to "+e),g.enqueueResolutionHeightChangeEvent(t,e),g._height=e)},this.setConnectionType=function(e){g._logger.debug("setConnectionType(): "+e);var t=g._connectionType;t!==e&&null!=e&&(g._logger.debug("Change network connection type from "+t+" to "+e),g.enqueueConnectionTypeChangeEvent(t,e),g._connectionType=e)},this.setLinkEncryption=function(e){g._logger.debug("setLinkEncryption(): "+e);var t=g._linkEncryption;t!==e&&null!=e&&(g._logger.debug("Change network link encryption from "+t+" to "+e),g.enqueueLinkEncryptionChangeEvent(t,e),g._linkEncryption=e)},this.setCDNServerIP=function(e){g._logger.debug("setCDNServerIP(): "+e);var t=g._cdnServerIP;t!==e&&O.isValidString(e)&&(g._logger.debug("Change CDN Server IP from "+t+" to "+e),g.enqueueCDNServerIPChangeEvent(t,e),g._cdnServerIP=e)},this.togglePauseJoin=function(e){if(g._logger.debug("togglePauseJoin()"),g._pauseJoin===e)return void g._logger.debug("togglePauseJoin(): same value, ignoring");var t=g._pauseJoin,n=!g._pauseJoin;g.enqueuePauseJoinChangeEvent(t,n),g._pauseJoin=!g._pauseJoin},this.sendError=function(e,t){g.enqueueErrorEvent(e,t)},this.enqueueEvent=function(e,t){if(t[S.REQUEST_EVENT_KEY_TYPE]=e,t[S.REQUEST_EVENT_KEY_SESSION_TIME]=this.getSessionTime(),t[S.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=this._eventQueue.getNumber(),this._playerStateManager){var n=b.Integer(this._playerStateManager.getPHT(),0,null,-1),i=b.Integer(this._playerStateManager.getBufferLength(),0,null,-1);n>=0&&(t[S.REQUEST_KEY_PLAYHEAD_TIME]=n),i>0&&(t[S.REQUEST_KEY_BUFFER_LENGTH]=i)}this._eventQueue.enqueue(t)},this.setPlayerStateManager=function(e){g._playerStateManager=e,null!=g._playerStateManager?g.startRfpsTimer():g.cancelRfpsTimer()},this.enqueueSessionEndEvent=function(){var e=this.getSessionTime(),t=this.getNextEventNumber(),n=this._cwsProtocol.generateSessionEndEvent(t,e);this._eventQueue.enqueue(n)},this.enqueueErrorEvent=function(e,t){var n={};n[S.REQUEST_ERROR_EVENT_KEY_MESSAGE]=e,n[S.REQUEST_ERROR_EVENT_KEY_FATAL]=t,this.enqueueEvent(S.EVENT_TYPE_ERROR,n)},this.enqueueBitrateChangeEvent=function(e,t){var n={},i={};e>0&&(i[S.REQUEST_KEY_BITRATE]=e),n[S.REQUEST_KEY_BITRATE]=t,this.declareStateChange(n,i)},this.enqueueSeekEvent=function(e,t){var n={};n[S.REQUEST_EVENT_KEY_SEEK_ACT_TYPE]=e,t>=0&&(n[S.REQUEST_EVENT_KEY_SEEK_TO_POS]=t),this.enqueueEvent(S.EVENT_TYPE_SEEK,n)},this.enqueueResolutionWidthChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[S.REQUEST_KEY_VIDEO_WIDTH]=e),n[S.REQUEST_KEY_VIDEO_WIDTH]=t,this.declareStateChange(n,i)},this.enqueueResolutionHeightChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[S.REQUEST_KEY_VIDEO_HEIGHT]=e),n[S.REQUEST_KEY_VIDEO_HEIGHT]=t,this.declareStateChange(n,i)},this.enqueueConnectionTypeChangeEvent=function(e,t){var n={},i={};null!==e&&(i[S.REQUEST_KEY_CONNECTION_TYPE]=e),n[S.REQUEST_KEY_CONNECTION_TYPE]=t,this.declareStateChange(n,i)},this.enqueueLinkEncryptionChangeEvent=function(e,t){var n={},i={};null!==e&&(i[S.REQUEST_KEY_LINK_ENCRYPTION]=e),n[S.REQUEST_KEY_LINK_ENCRYPTION]=t,this.declareStateChange(n,i)},this.enqueueCDNServerIPChangeEvent=function(e,t){var n={},i={};O.isValidString(e)&&(i[S.REQUEST_CDN_SERVER_IP]=e),n[S.REQUEST_CDN_SERVER_IP]=t,this.declareStateChange(n,i)},this.enqueuePauseJoinChangeEvent=function(e,t){var n={},i={};i[S.REQUEST_KEY_PAUSE_JOIN]=e,n[S.REQUEST_KEY_PAUSE_JOIN]=t,this.declareStateChange(n,i)},this.enqueuePlayerStateChangeEvent=function(e,t){var n={},i={};n[S.REQUEST_KEY_PLAYER_STATE]=S.convertPlayerState(t),i[S.REQUEST_KEY_PLAYER_STATE]=S.convertPlayerState(e),this.declareStateChange(n,i)},this.declareStateChange=function(e,t){var n={};n[S.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=e,null!=t&&O.dictCount(t)>0&&(n[S.REQUEST_STATE_CHANGE_EVENT_KEY_OLD]=t),this.enqueueEvent(S.EVENT_TYPE_STATE_CHANGE,n)},this.enqueueCustomEvent=function(e,t){var n={};n[S.REQUEST_CUSTOM_EVENT_KEY_NAME]=e,n[S.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES]=t,this.enqueueEvent(S.EVENT_TYPE_CUSTOM,n)},this.cancelHeartbeatTimer=function(){null!=g._heartbeatTimerCancel&&(g._heartbeatTimerCancel(),g._heartbeatTimerCancel=null)},this.resetHeartbeatTimer=function(){g.cancelHeartbeatTimer();var e=1e3*g._clientSettings.heartbeatInterval;g._heartbeatTimerCancel=g._timer.create(g.sendHeartbeat,e,"Session.sendHeartbeat")},this.cancelRfpsTimer=function(){null!=g._rfpsTimerCancel&&(g._rfpsTimerCancel(),g._rfpsTimerCancel=null)},this.startRfpsTimer=function(){g.cancelRfpsTimer(),g._rfpsTimerCancel=g._timer.create(g.countRfps,g._rfpsTimerInterval,"Session.startRfpsTimer")},this.createHeartbeatInfo=function(){var e={};e.err="pending",e.seq=g._heartbeatSequenceNumber-1,e.sentAt=g.getSessionTime(),e.rtt=-1,g._heartbeatInfos.push(e)},this.updateHeartbeatInfoOnFailure=function(e,t){for(var n=0;n<g._heartbeatInfos.length;n++){var i=g._heartbeatInfos[n];i.seq===e&&(i.rtt=g.getSessionTime()-i.sentAt,i.err=t)}},this.updateHeartbeatInfoOnSuccess=function(e){for(var t=0;t<g._heartbeatInfos.length;t++){var n=g._heartbeatInfos[t];n.seq===e&&(n.rtt=g.getSessionTime()-n.sentAt,n.err="ok")}},this.removeOutdatedHeartbeatInfos=function(){for(var e,t=g._clientConfig.get(N.CONFIG_KEY_MAX_HEARTBEAT_INFOS),n=[],i=0;i<g._heartbeatInfos.length;i++)e=g._heartbeatInfos[i],e.seq<g._heartbeatSequenceNumber-t&&n.push(i);for(var r=[],a=0;a<g._heartbeatInfos.length;a++)e=g._heartbeatInfos[a],e.seq,n.indexOf(a)<0&&r.push(g._heartbeatInfos[a]);g._heartbeatInfos=r},this.compileHeartbeatInfos=function(){g.removeOutdatedHeartbeatInfos();for(var e=[],t=0;t<g._heartbeatInfos.length;t++){var n=g._heartbeatInfos[t],i={};i[S.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER]=n.seq,i[S.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME]=n.rtt,i[S.REQUEST_HEARTBEAT_INFO_KEY_STATUS]=n.err,e.push(i)}return e},this.makeHeartbeat=function(){var e=g._eventQueue.flush();if(g.isGlobalSession()&&0===e.length)return null;var t=new R;if(t.setMessageType(S.MESSAGE_TYPE_SESSION_HEARTBEAT),t.setCustomerKey(g._clientSettings.customerKey),t.setClientId(g._clientConfig.get(N.CONFIG_KEY_CLIENT_ID)),t.setSessionId(g._session._id),t.setSequenceNumber(g._heartbeatSequenceNumber),t.setProtocolVersion(S.version),t.setClientVersion(n.version),t.setInstanceId(g._client.getId()),t.setCapfield(0),null!=g._connectionType&&t.setConnectionType(g._connectionType),null!=g._linkEncryption&&t.setLinkEncryption(g._linkEncryption),O.isValidString(g._cdnServerIP)&&t.setCDNServerIP(g._cdnServerIP),t.setPlatformMetadataSchema(S.SDK_METADATA_SCHEMA),null!=g._browserName&&t.setBrowserName(g._browserName),null!=g._browserVersion&&t.setBrowserVersion(g._browserVersion),null!=g._deviceBrand&&t.setDeviceBrand(g._deviceBrand),null!=g._deviceManufacturer&&t.setDeviceManufacturer(g._deviceManufacturer),null!=g._deviceModel&&t.setDeviceModel(g._deviceModel),null!=g._deviceType&&t.setDeviceType(g._deviceType),null!=g._deviceVersion&&t.setDeviceVersion(g._deviceVersion),null!=g._frameworkName&&t.setFrameworkName(g._frameworkName),null!=g._frameworkVersion&&t.setFrameworkVersion(g._frameworkVersion),null!=g._operatingSystemName&&t.setOperatingSystemName(g._operatingSystemName),null!=g._operatingSystemVersion&&t.setOperatingSystemVersion(g._operatingSystemVersion),null!=g._deviceCategory&&t.setDeviceCategory(g._deviceCategory),null!=g._playerStateManager&&(g._moduleName=g._playerStateManager.getModuleName(),null!=g._moduleName&&t.setModuleName(g._moduleName)),null!=g._playerStateManager&&(g._moduleVersion=g._playerStateManager.getModuleVersion(),null!=g._moduleVersion&&t.setModuleVersion(g._moduleVersion)),null!=g._viewerId&&t.setViewerId(g._viewerId),O.dictCount(g._tags)>0&&t.setTags(g._tags),g.isVideoSession()||g.isAdSession()){g.isAdSession()&&t.setIsAdSession(),null!=g._assetName&&t.setAssetName(g._assetName),t.setSessionFlags(g._sessionFlags);var i=S.convertPlayerState(g._playerState);t.setPlayerState(i),t.setPauseJoin(g._pauseJoin),null!=g._playerName&&t.setPlayerName(g._playerName),null!=g._isLive&&t.setIsLive(g._isLive),g._contentLengthSec>0&&t.setContentLength(g._contentLengthSec),g._bitrateKbps>0&&t.setBitrate(g._bitrateKbps),null!==g._resource&&t.setResource(g._resource),g._encodedFrameRate>0&&t.setEncodedFrameRate(g._encodedFrameRate);var r,a,o;null!=g._playerStateManager&&(r=b.Integer(g._playerStateManager.getPHT(),0,null,-1),a=b.Integer(g._playerStateManager.getBufferLength(),0,null,-1),o=g._playerStateManager.getSignalStrength()),r>=0&&t.setPlayheadTime(r),a>0&&t.setBufferLength(a);var s=g.updateAverageFrameRate();s>0&&t.setAverageFrameRate(s),g._playingFpsTotal>0&&t.setRfpsTotal(b.Integer(g._playingFpsTotal,0,null,-1)),g._playingFpsObservationCount>0&&t.setRfpsObservationCount(b.Integer(g._playingFpsObservationCount,0,null,-1)),o<=0&&t.setSignalStrength(o),null!=g._streamUrl&&t.setStreamUrl(g._streamUrl),g._width>0&&t.setStreamWidth(g._width),g._height>0&&t.setStreamHeight(g._height)}else t.setSessionFlags(S.SessionFlags.GLOBAL);if(e.length>0&&t.setEvents(e),t.setCapabilities(g._capabilities),t.setIsSdkClient(!0),g._clientConfig.get(N.CONFIG_KEY_SEND_LOGS)&&t.setLogs(g._logBuffer.flush()),g._clientConfig.get(N.CONFIG_KEY_MAX_HEARTBEAT_INFOS)>0){var _=g.compileHeartbeatInfos();_.length>0&&t.setHeartbeatInfos(_)}return 0==g._heartbeatSequenceNumber&&(t=g.cloneHearbeatWithBrowserTags(t)),g._startConvivaIdCollection&&(t=g.cloneHeartbeatWithConvivaIdTags(t)),t.setSessionStartTime(g._startTimeMs),t.setSessionTime(g.getSessionTime()),g._heartbeatSequenceNumber++,t.get()},this.cloneHeartbeatWithConvivaIdTags=function(e){var t=g._uniqueIdentifiers,n={};for(var i in e._data.tags)t.hasOwnProperty(i)||(n[i]=e._data.tags[i]);e._data.tags=n,g._uniqueIdentifiers={};for(var r=0;r<g.whitelistedIdentifiers.length;r++)g._client._uniqueIdentifiers.hasOwnProperty(g.whitelistedIdentifiers[r])?g._client._userPrefForData.hasOwnProperty(g.whitelistedIdentifiers[r])?g._client._userPrefForData[g.whitelistedIdentifiers[r]]==N.ConvivaIdErrorCodes.CONVIVAID_USER_OPTOUT?(g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=N.ConvivaIdErrorCodes.CONVIVAID_USER_OPTOUT,g._client._uniqueIdentifierCallback("End-user chose to opt-out of personal data collection")):g._client._userPrefForData[g.whitelistedIdentifiers[r]]==N.ConvivaIdErrorCodes.CONVIVAID_USER_OPT_DELETE?(g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=N.ConvivaIdErrorCodes.CONVIVAID_USER_OPT_DELETE,g._client._uniqueIdentifierCallback("End-user chose to opt-out of personal data collection")):g._client._userPrefForData[g.whitelistedIdentifiers[r]]==N.ConvivaIdErrorCodes.CONVIVAID_PRIVACY_RESTRICTION?(g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=N.ConvivaIdErrorCodes.CONVIVAID_PRIVACY_RESTRICTION,g._client._uniqueIdentifierCallback("End-user used privacy settings and chose to opt-out of personal data collection")):(g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=g._client._uniqueIdentifiers[g.whitelistedIdentifiers[r]],g._client._uniqueIdentifierCallback("Data collection successful")):(g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=g._client._uniqueIdentifiers[g.whitelistedIdentifiers[r]],g._client._uniqueIdentifierCallback("Data collection successful")):g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+g.whitelistedIdentifiers[r]]=N.ConvivaIdErrorCodes.CONVIVAID_NA;var a={};for(var o in t){var s=o.split(".");"{}"!=JSON.stringify(g.whitelistedIdentifiers)&&-1!=g.whitelistedIdentifiers.indexOf(""+s[2])||t[N.CONVIVAID_FP_PREFIX+""+s[2]]==N.ConvivaIdErrorCodes.CONVIVAID_SERVER_RESTRICTION||(g._client._uniqueIdentifierCallback("Data collection restricted from Conviva back-end"),g._uniqueIdentifiers[N.CONVIVAID_FP_PREFIX+""+s[2]]=N.ConvivaIdErrorCodes.CONVIVAID_SERVER_RESTRICTION,a[N.CONVIVAID_FP_PREFIX+""+s[2]]=N.ConvivaIdErrorCodes.CONVIVAID_SERVER_RESTRICTION)}if("{}"!==JSON.stringify(g._uniqueIdentifiers)){var _=O.ObjectShallowCopy(g._uniqueIdentifiers);for(var l in e._data.tags)_[l]=e._data.tags[l];if(e._data.tags=_,!O.ObjectShallowEquals(t,g._uniqueIdentifiers)){var u={};if("{}"!==JSON.stringify(a)&&(u[S.REQUEST_KEY_TAGS]=a),"{}"!==JSON.stringify(t)){for(var c in t)void 0!==g._uniqueIdentifiers[c]&&t[c]!==g._uniqueIdentifiers[c]&&(void 0==u[S.REQUEST_KEY_TAGS]&&(u[S.REQUEST_KEY_TAGS]={}),u[S.REQUEST_KEY_TAGS][c]=g._uniqueIdentifiers[c]);for(var c in g._uniqueIdentifiers)t.hasOwnProperty(c)&&t[c]===g._uniqueIdentifiers[c]||(void 0==u[S.REQUEST_KEY_TAGS]&&(u[S.REQUEST_KEY_TAGS]={}),u[S.REQUEST_KEY_TAGS][c]=g._uniqueIdentifiers[c])}"{}"==JSON.stringify(t)&&(u[S.REQUEST_KEY_TAGS]=g._uniqueIdentifiers);var E={};if(E[S.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=u,E[S.REQUEST_EVENT_KEY_TYPE]=S.EVENT_TYPE_STATE_CHANGE,E[S.REQUEST_EVENT_KEY_SESSION_TIME]=g.getSessionTime(),E[S.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=g._eventQueue.getNumber(),g._playerStateManager){var d=b.Integer(g._playerStateManager.getPHT(),0,null,-1),h=b.Integer(g._playerStateManager.getBufferLength(),0,null,-1);d>=0&&(E[S.REQUEST_KEY_PLAYHEAD_TIME]=d),h>0&&(E[S.REQUEST_KEY_BUFFER_LENGTH]=h)}void 0==e._data.evs&&(e._data.evs=[]),e._data.evs.push(E)}}return e},this.cloneHearbeatWithBrowserTags=function(e){var t=g.getBrowserMetadata();if("{}"!==JSON.stringify(t)){var n=O.ObjectShallowCopy(t);for(var i in e._data.tags)n[i]=e._data.tags[i];e._data.tags=n;var r={};r[S.REQUEST_KEY_TAGS]=t;var a={};if(a[S.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=r,a[S.REQUEST_EVENT_KEY_TYPE]=S.EVENT_TYPE_STATE_CHANGE,a[S.REQUEST_EVENT_KEY_SESSION_TIME]=g.getSessionTime(),a[S.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=g._eventQueue.getNumber(),g._playerStateManager){var o=b.Integer(g._playerStateManager.getPHT(),0,null,-1),s=b.Integer(g._playerStateManager.getBufferLength(),0,null,-1);o>=0&&(a[S.REQUEST_KEY_PLAYHEAD_TIME]=o),s>0&&(a[S.REQUEST_KEY_BUFFER_LENGTH]=s)}return void 0==e._data.evs&&(e._data.evs=[]),e._data.evs.push(a),e}return e},this.getBrowserMetadata=function(){var e={};if(null!=navigator){if(e["fp.cookie"]=void 0!==navigator.cookieEnabled?""+navigator.cookieEnabled:"",e["fp.memory"]=(navigator.deviceMemory,""+navigator.deviceMemory),e["fp.hwConc"]=null!=navigator.hardwareConcurrency&&void 0!=navigator.hardwareConcurrency?""+navigator.hardwareConcurrency:"",e["fp.java"]=""+navigator.javaEnabled(),e["fp.lang"]=null!=navigator.language&&void 0!=navigator.language?""+navigator.language:"",e["fp.langs"]=null!=navigator.languages&&navigator.languages.length>0?""+navigator.languages.toString():"",e["fp.maxTp"]=null!=navigator.maxTouchPoints&&void 0!=navigator.maxTouchPoints?""+navigator.maxTouchPoints:"",e["fp.plugins"]="",null!=navigator.plugins&&navigator.plugins.length>0)for(var t=0;t<navigator.plugins.length;t++)e["fp.plugins"]+=navigator.plugins[t].name+",";if(e["fp.mime"]="",null!=navigator.mimeTypes&&navigator.mimeTypes.length>0)for(var n=0;n<navigator.mimeTypes.length;n++)e["fp.mime"]+=navigator.mimeTypes[n].type+",";e["fp.sysLang"]=null!=navigator.systemLanguage&&void 0!=navigator.systemLanguage?""+navigator.systemLanguage:"",e["fp.availHeight"]=null!=window.screen&&null!=window.screen.availHeight?""+window.screen.availHeight:"",e["fp.availWidth"]=null!=window.screen&&null!=window.screen.availWidth?""+window.screen.availWidth:"",e["fp.height"]=null!=window.screen&&null!=window.screen.height?""+window.screen.height:"",e["fp.width"]=null!=window.screen&&null!=window.screen.width?""+window.screen.width:"",e["fp.colorDepth"]=null!=window.screen&&null!=window.screen.colorDepth?""+window.screen.colorDepth:"",e["fp.deviceXDPI"]=null!=window.screen&&null!=window.screen.deviceXDPI?""+window.screen.deviceXDPI:"",e["fp.deviceYDPI"]=null!=window.screen&&null!=window.screen.deviceYDPI?""+window.screen.deviceYDPI:"",e["fp.dpi"]=null!=window.devicePixelRatio?""+window.devicePixelRatio:"",e["fp.secure"]=null!=window.isSecureContext?""+window.isSecureContext:"",e["fp.platform"]=null!=navigator.platform&&void 0!=navigator.platform?""+navigator.platform:"",e["fp.product"]=null!=navigator.product&&void 0!=navigator.product?""+navigator.product:"",e["fp.productSub"]=null!=navigator.productSub&&void 0!=navigator.productSub?""+navigator.productSub:"",e["fp.vendor"]=null!=navigator.vendor&&void 0!=navigator.vendor?""+navigator.vendor:"",e["fp.vendorSub"]=null!=navigator.vendorSub&&void 0!=navigator.vendorSub?""+navigator.vendorSub:""}return e},this.sendHeartbeat=function(){if(!g._cleanedUp){var e=g.makeHeartbeat();null!=e&&g.postHeartbeat(e)}},this.countRfps=function(){if(g._playerState===s.PlayerState.PLAYING){var e=g._playerStateManager.getRenderedFrameRate();e>=0&&(g._playingFpsTotal+=e,g._playingFpsObservationCount++)}},this.updateAverageFrameRate=function(){if(g._playerState===s.PlayerState.PLAYING){var e=g._playerStateManager.getRenderedFrameRate();return e>=0?(g._playingFpsTotal+=e,g._playingFpsObservationCount++,O.Int32.Cast(1*g._playingFpsTotal/g._playingFpsObservationCount)):-1}return-1},this.postHeartbeat=function(e){g.createHeartbeatInfo();var t=g._heartbeatSequenceNumber-1;g._logger.info("postHeartbeat(): Send HB["+t+"]"+g.sessionTypeTag());var n=function(e,n){g.onHeartbeatResponse(e,n,t)};g._gatewayControl.send(e,n)},this.onHeartbeatResponse=function(e,t,n){g._cleanedUp||g._exceptionCatcher.runProtected("onHeartbeatResponse",function(){if(e){var i=t;if(null!=i){g._logger.debug("onHeartbeatResponse(): received valid response for HB["+n+"]"),g.updateHeartbeatInfoOnSuccess(n);var r=i[S.RESPONSE_KEY_CLIENT_ID];null!=r&&r!=g._clientConfig.get(N.CONFIG_KEY_CLIENT_ID)&&(g._logger.debug("onHeartbeatResponse(): setting the client id to "+r+" (from gateway)"),g._clientConfig.set(N.CONFIG_KEY_CLIENT_ID,r),g._clientConfig.save());var a=i[S.RESPONSE_KEY_STATUS];null!=a&&a!=S.RESPONSE_STATUS_NO_ERRORS&&g._logger.error("onHeartbeatResponse(): error from gateway: "+a);var o=i[S.RESPONSE_KEY_CONFIG];if("object"==typeof o){var s=o[S.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS];null!=s&&g._clientConfig.get(N.CONFIG_KEY_MAX_HEARTBEAT_INFOS)!==s&&(g._logger.debug("onHeartbeatResponse(): setting Maximum Heartbeat Infos to "+s+" (from gateway)"),g._clientConfig.set(N.CONFIG_KEY_MAX_HEARTBEAT_INFOS,s));var _=o[S.RESPONSE_CONFIG_KEY_SEND_LOGS],l=null!=_&&O.AsBoolean(_);l!==g._clientConfig.get(N.CONFIG_KEY_SEND_LOGS)&&(g._logger.debug("onHeartbeatResponse(): turning "+(l?"on":"off")+" sending of logs"),g._clientConfig.set(N.CONFIG_KEY_SEND_LOGS,l));var u=o[S.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL];if(null!=u){var c=O.Int32.Cast(u),E=c;E!=g._clientSettings.heartbeatInterval&&(g._logger.debug("onHeartbeatResponse(): received hbIntervalMs from gateway: "+E),g._clientSettings.heartbeatInterval=E,null!=g._heartbeatTimerCancel&&g.resetHeartbeatTimer())}var d=o[S.RESPONSE_CONFIG_KEY_GATEWAY_URL];null!=d&&d!=g._clientSettings.gatewayUrl&&(g._logger.debug("onHeartbeatResponse(): received gatewayUrl from gateway: "+d),g._clientSettings.gatewayUrl=d),g.whitelistedIdentifiers={};var h=o[S.RESPONSE_CONFIG_KEY_CONVIVAID_FP];null!=h&&(g._startConvivaIdCollection||(g._startConvivaIdCollection=!0),g._logger.debug("onHeartbeatResponse(): received fp from gateway: "+h),g.whitelistedIdentifiers=h.split(","))}}else g._logger.warning("onHeartbeatResponse(): decoded heartbeat response is null.")}else{var f=t;O.isValidString(f)?O.stringStartsWith(f,"HTTP timeout")?g._logger.warning("onHeartbeatResponse(): "+f):g._logger.error("onHeartbeatResponse(): failed to send heartbeat: "+f):(f=m.DEFAULT_HEARTBEAT_ERROR_MESSAGE,g._logger.error("onHeartbeatResponse(): "+f)),g.updateHeartbeatInfoOnFailure(n,f)}})},this.getSessionTime=function(){return O.Int32.Cast(g._time.current()-g._startTimeMs)},this.getNextEventNumber=function(){return this._eventQueue.getNumber()},this.sessionTypeTag=function(){return this.isGlobalSession()?" (global session)":""},this.isGlobalSession=function(){return this._global==I.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return this._global==I.SESSION_TYPE.VIDEO},this.isAdSession=function(){return this._global==I.SESSION_TYPE.AD}};I.DEFAULT_VIDEO_SESSION_FLAGS=S.SessionFlags.VIDEO+S.SessionFlags.QUALITY_METRICS+S.SessionFlags.BITRATE_METRICS,I.SESSION_TYPE={VIDEO:"Video",GLOBAL:"Global",AD:"Ad"};var m=(t.IMonitor=function(){this.onPlayerStateChange=function(e){},this.onBitrateChange=function(e){},this.onSeekEvent=function(e,t){},this.onEncodedFrameRateChange=function(e){},this.onRenderedFrameRateChange=function(e){},this.onContentLengthChange=function(e){},this.onPlayheadTimeChange=function(e){},this.onStreamUrlChange=function(e){},this.onBufferLengthChange=function(e){},this.onPlayerTypeChange=function(e){},this.onPlayerVersionChange=function(e){},this.onStreamResolutionWidthChange=function(e){},this.onStreamResolutionHeightChange=function(e){},this.onConnectionTypeChange=function(e){},this.onLinkEncryptionChange=function(e){},this.onSignalStrengthChange=function(e){},this.onError=function(e,t){},this.onRelease=function(){},this.onCDNServerIPChange=function(e){}},t.Session=function(){function t(e,t,n,i,r,a,o,s){this._id=e,this._global=t,this._contentMetadata=n,this._clientConfig=i,this._systemMetadata=r,this._cwsSession=a,this._exceptionCatcher=o,this._logger=s,this._logger.setModuleName("Session"),this._logger.setSessionId(O.ToString(this._id))}var n=this;n._contentMetadata=null,n._playerStateManager=null,n._id=0,n._global=I.SESSION_TYPE.VIDEO,n._cleaningUp=!1,n._cleanedUp=!1,n._adPlaying=!1,n._adStream=null,n._adPlayer=null,n._adPosition=null,n._ignorePlayerState=!1,n._pooledPlayerState=s.PlayerState.NOT_MONITORED,n._ignoreBitrateAndResource=!1,n._ignorePlayheadTimeandBufferLength=!1,n._ignoreEncodedFrameRateAndDuration=!1,n._ignoreError=!1,t.apply(n,arguments),this.start=function(){if(n.isVideoSession()||n.isAdSession()?n._logger.info("start(): assetName="+n._contentMetadata.assetName):n._logger.info("start()"+n.sessionTypeTag()),n._cwsSession.start(this),n._clientConfig.isReady())n.initiateSession();else{var e=function(){n.initiateSession()};n._clientConfig.register(e)}},this.cleanup=function(){if(n._logger.info("cleanup()"+n.sessionTypeTag()),n._cleaningUp=!0,n._cwsSession.willEndSoon(),n._clientConfig.isReady())n.endCwsSessionAndCleanupAll();else{var e=function(){n.endCwsSessionAndCleanupAll()};n._clientConfig.register(e)}},this.cleanupAll=function(){n._logger.debug("cleanupAll()"+n.sessionTypeTag()),(n.isVideoSession()||n.isAdSession())&&null!=n._playerStateManager&&n.detachPlayer(),n._contentMetadata=null,n._logger.setSessionId(null),n._logger=null,n._exceptionCatcher=null,n._client=null,n._clientConfig=null,n._systemMetadata=null,n._cwsSession.cleanup(),n._cwsSession=null,n._cleanedUp=!0},this.endCwsSessionAndCleanupAll=function(){n._cwsSession.end(),n.cleanupAll()},this.initiateSession=function(){n._cwsSession.initialize(),n.setStatesFromSystemMetadata(),(n.isVideoSession()||n.isAdSession())&&(n.setStatesFromContentMetadata(),n.enqueueEventForContentMetadata()),n._cwsSession.startSendingHeartbeats()},this.enqueueEventForContentMetadata=function(){var t={};if(null!=n._contentMetadata.assetName?t[S.REQUEST_KEY_ASSET_NAME]=n._contentMetadata.assetName:n._logger.warning("enqueueEventForContentMetadata(): assetName was not set."),null!=n._contentMetadata.applicationName?t[S.REQUEST_KEY_PLAYER_NAME]=n._contentMetadata.applicationName:n._logger.warning("enqueueEventForContentMetadata(): applicationName was not set."),null!=n._contentMetadata.streamUrl?t[S.REQUEST_KEY_STREAM_URL]=n._contentMetadata.streamUrl:n._logger.warning("enqueueEventForContentMetadata(): streamUrl was not set."),null!=n._contentMetadata.viewerId?t[S.REQUEST_KEY_VIEWER_ID]=n._contentMetadata.viewerId:n._logger.warning("enqueueEventForContentMetadata(): viewerId was not set."),null!=n._contentMetadata.defaultResource?t[S.REQUEST_KEY_RESOURCE]=n._contentMetadata.defaultResource:n._logger.warning("enqueueEventForContentMetadata(): defaultResource was not set."),n._contentMetadata.duration>-1?t[S.REQUEST_KEY_CONTENT_LENGTH]=n._contentMetadata.duration:n._logger.warning("enqueueEventForContentMetadata(): duration was not set."),n._contentMetadata.encodedFrameRate>-1?t[S.REQUEST_KEY_ENCODED_FRAME_RATE]=n._contentMetadata.encodedFrameRate:n._logger.warning("enqueueEventForContentMetadata(): encodedFrameRate was not set."),n._contentMetadata.streamType!=r.StreamType.UNKNOWN?n._contentMetadata.streamType==e.ContentMetadata.StreamType.LIVE?t[S.REQUEST_KEY_IS_LIVE]=!0:t[S.REQUEST_KEY_IS_LIVE]=!1:n._logger.warning("enqueueEventForContentMetadata(): streamType was not set."),O.dictCount(n._contentMetadata.custom)>0){t[S.REQUEST_KEY_TAGS]={};for(var i in n._contentMetadata.custom)t[S.REQUEST_KEY_TAGS][i]=n._contentMetadata.custom[i]}else n._logger.warning("enqueueEventForContentMetadata(): custom tags were not set.");O.dictCount(t)>0&&n._cwsSession.declareStateChange(t,null)},this.setStatesFromSystemMetadata=function(){n._logger.debug("setStatesFromSystemMetadata()");var e=n._systemMetadata.get(),t=e[L.BROWSER_NAME];null!=t&&n._cwsSession.setBrowserName(t);var i=e[L.BROWSER_VERSION];null!=i&&n._cwsSession.setBrowserVersion(i);var r=e[L.DEVICE_BRAND];null!=r&&n._cwsSession.setDeviceBrand(r);var a=e[L.DEVICE_MANUFACTURER];null!=a&&n._cwsSession.setDeviceManufacturer(a);var o=e[L.DEVICE_MODEL];null!=o&&n._cwsSession.setDeviceModel(o);var s=e[L.DEVICE_TYPE];null!=s&&n._cwsSession.setDeviceType(s);var _=e[L.DEVICE_VERSION];null!=_&&n._cwsSession.setDeviceVersion(_);var l=e[L.FRAMEWORK_NAME];null!=l&&n._cwsSession.setFrameworkName(l);var u=e[L.FRAMEWORK_VERSION];null!=u&&n._cwsSession.setFrameworkVersion(u);var c=e[L.OPERATING_SYSTEM_NAME];null!=c&&n._cwsSession.setOperatingSystemName(c);var E=e[L.OPERATING_SYSTEM_VERSION];null!=E&&n._cwsSession.setOperatingSystemVersion(E);var d=e[L.DEVICE_CATEGORY];null!=d&&n._cwsSession.setDeviceCategory(d)},this.setStatesFromContentMetadata=function(){if(n._logger.debug("setStatesFromContentMetadata()"),null!=n._contentMetadata.defaultResource&&n._cwsSession.setResource(n._contentMetadata.defaultResource),null!=n._contentMetadata.streamUrl&&n._cwsSession.setStreamUrl(n._contentMetadata.streamUrl),n._contentMetadata.duration>0&&n._cwsSession.setContentLength(n._contentMetadata.duration),n._contentMetadata.encodedFrameRate>0&&n._cwsSession.setEncodedFrameRate(n._contentMetadata.encodedFrameRate),n._contentMetadata.streamType!==r.StreamType.UNKNOWN){var e=n._contentMetadata.streamType===r.StreamType.LIVE;n._cwsSession.setIsLive(e)}null!=n._contentMetadata.assetName&&n._cwsSession.setAssetName(n._contentMetadata.assetName),null!=n._contentMetadata.viewerId&&n._cwsSession.setViewerId(n._contentMetadata.viewerId),null!=n._contentMetadata.applicationName&&n._cwsSession.setPlayerName(n._contentMetadata.applicationName),O.dictCount(n._contentMetadata.custom)>0&&n._cwsSession.setTags(n._contentMetadata.custom)},this.onPlayerStateChange=function(e){if(n._logger.debug("onPlayerStateChange(): "+e),n._cwsSession._playerState!=e){if(n._cwsSession._playerState==s.PlayerState.NOT_MONITORED&&e!=s.PlayerState.NOT_MONITORED&&(n._pooledPlayerState=e),n._ignorePlayerState)return void n._logger.debug("onPlayerStateChange(): "+e+" (pooled, "+(n._adPlaying?"ad playing":"preloading")+")");n._cwsSession.setPlayerState(e)}},this.onBitrateChange=function(e){if(n._logger.debug("onBitrateChange(): "+e),n._ignoreBitrateAndResource)return void n._logger.info("onBitrateChange(): ignored");n._cwsSession.setBitrateKbps(e)},this.onSeekEvent=function(e,t){null==t||O.isInteger(t)||(n._logger.error("onSeekEvent(): Ignored non-integer seekToPosition data: "+t),t=-1),n._cwsSession.enqueueSeekEvent(e,t)},this.onEncodedFrameRateChange=function(e){n._logger.debug("onEncodedFrameRateChange(): "+e),n._contentMetadata.encodedFrameRate>0||(e>0?n._ignoreEncodedFrameRateAndDuration?n._logger.info("onEncodedFrameRateChange(): Ignored encoded frame rate data: "+e+" (ads)"):(n._cwsSession.setEncodedFrameRate(e),n._logger.info("onEncodedFrameRateChange(): Received encoded frame rate data: "+e)):n._logger.warning("onEncodedFrameRateChange(): Ignored invalid encoded frame rate data: "+e))},this.onContentLengthChange=function(e){n._logger.debug("onContentLengthChange(): "+e),n._contentMetadata.duration>0||(e>0?n._ignoreEncodedFrameRateAndDuration?n._logger.info("setContentLength(): Ignored content length data: "+e+" (ads)"):(n._cwsSession.setContentLength(e),n._logger.info("setContentLength(): Received content length data: "+e)):n._logger.warning("setContentLength(): Ignored invalid content length data: "+e))},this.onStreamUrlChange=function(e){n._logger.debug("onStreamUrlChange(): "+e),null==n._contentMetadata.streamUrl&&n._cwsSession.setStreamUrl(e)},this.onStreamResolutionWidthChange=function(e){n._logger.debug("onStreamResolutionWidthChange(): "+e),n._cwsSession.setStreamResolutionWidth(e)},this.onStreamResolutionHeightChange=function(e){n._logger.debug("onStreamResolutionHeightChange(): "+e),n._cwsSession.setStreamResolutionHeight(e)},this.onConnectionTypeChange=function(e){n._logger.debug("onConnectionTypeChange(): "+e),n._cwsSession.setConnectionType(e)},this.onLinkEncryptionChange=function(e){n._logger.debug("onLinkEncryptionChange(): "+e),n._cwsSession.setLinkEncryption(e)},this.onPlayerTypeChange=function(e){n._logger.debug("onPlayerTypeChange(): "+e),null==n._cwsSession.getFrameworkName()&&n._cwsSession.setFrameworkName(e)},this.onPlayerVersionChange=function(e){n._logger.debug("onPlayerVersionChange(): "+e),null==n._cwsSession.getFrameworkVersion()&&n._cwsSession.setFrameworkVersion(e)},this.onCDNServerIPChange=function(e){n._logger.debug("onCDNServerIPChange(): "+e),n._cwsSession.setCDNServerIP(e)},this.onError=function(e,t){n._logger.debug("onError(): "+e+" ("+t+")"),n.reportError(e,t)},this.onRelease=function(){n._logger.debug("onRelease()"),n.detachPlayer()},this.adStart=function(t,i,r){if(n._logger.debug("adStart(): adStream="+t+" adPlayer="+i+" adPosition="+r),n._adPlaying)return void n._logger.warning("adStart(): multiple adStart calls, ignoring");n._adPlaying=!0,n._adStream=t,n._adPlayer=i,n._adPosition=r,n._cwsSession._hasJoined||n._cwsSession.togglePauseJoin(!0),n._adStream==e.Client.AdStream.CONTENT||n._adPlayer==e.Client.AdPlayer.SEPARATE?(n._cwsSession._playerState!==s.PlayerState.NOT_MONITORED&&(n._pooledPlayerState=n._cwsSession._playerState),n._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED),n._ignorePlayerState=!0):n._adStream==e.Client.AdStream.SEPARATE&&n._adPlayer==e.Client.AdPlayer.CONTENT&&(n._cwsSession._playerState!==s.PlayerState.NOT_MONITORED&&(n._pooledPlayerState=n._cwsSession._playerState),n._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED),n._ignorePlayerState=!0,n._ignoreBitrateAndResource=!0,n._ignoreEncodedFrameRateAndDuration=!0,n._ignorePlayheadTimeandBufferLength=!0,n._ignoreError=!0)},this.adEnd=function(){if(n._logger.debug("adEnd()"),!n._adPlaying)return void n._logger.debug("adEnd(): called before adStart, ignoring");n._cwsSession._hasJoined||n._cwsSession.togglePauseJoin(!1),n._adStream==e.Client.AdStream.CONTENT||n._adPlayer==e.Client.AdPlayer.SEPARATE?n._preloading||(n._ignorePlayerState=!1,n._cwsSession.setPlayerState(n._pooledPlayerState)):n._adStream==e.Client.AdStream.SEPARATE&&n._adPlayer==e.Client.AdPlayer.CONTENT&&(n._ignoreBitrateAndResource=!1,n._ignoreEncodedFrameRateAndDuration=!1,n._ignorePlayheadTimeandBufferLength=!1,n._ignoreError=!1,n._preloading||(n._ignorePlayerState=!1,n._cwsSession.setPlayerState(n._pooledPlayerState))),n._adPlaying=!1,n._adStream=n._adPlayer=n._adPosition=null},this.detachPlayer=function(){n._logger.debug("detachPlayer()"),null!==n._playerStateManager&&(n._exceptionCatcher.runProtected("Session.detachPlayer",function(){n._playerStateManager.removeMonitoringNotifier()}),n._playerStateManager=null,n._cwsSession.setPlayerStateManager(null),n._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED))},this.attachPlayer=function(e){if(n._logger.debug("attachPlayer()"),null!=n._playerStateManager)return void n._logger.error("attachPlayer(): detach current PlayerStateManager first");n._exceptionCatcher.runProtected("Session.attachPlayer()",function(){e.setMonitoringNotifier(n,n._id)?(e.pushCurrentState(),n._playerStateManager=e,n._cwsSession.setPlayerStateManager(n._playerStateManager)):n._logger.error("attachPlayer(): instance of PlayerStateManager is already attached to a session")})},this.getPlayerStateManager=function(){return n._logger.debug("getPlayerStateManager()"),n._playerStateManager},this.contentPreload=function(){if(n._logger.debug("contentPreload()"),n._preloading)return void n._logger.debug("contentPreload(): called twice, ignoring");n._preloading=!0,n._ignorePlayerState=!0},this.contentStart=function(){if(n._logger.debug("contentStart()"),!n._preloading)return void n._logger.warning("contentStart(): called without contentPreload, ignoring");n._preloading=!1,n._adPlaying||(n._ignorePlayerState=!1,n._cwsSession.setPlayerState(n._pooledPlayerState))},this.reportError=function(t,i){if(n._logger.info("reportError(): "+t),!O.isValidString(t))return void n._logger.error("reportError(): invalid error message string: "+t);if(i!==e.Client.ErrorSeverity.FATAL&&i!==e.Client.ErrorSeverity.WARNING)return void n._logger.error("reportError(): invalid error severity: "+i);if(n._ignoreError)return void n._logger.debug("reportError(): ignored");var r=i===e.Client.ErrorSeverity.FATAL;n._cwsSession.sendError(t,r)},this.updateContentMetadata=function(e){n._logger.debug("updateContentMetadata(): enter"),n._exceptionCatcher.runProtected("Session.updateContentMetadata",function(){n.mergeContentMetadata(e),n.setStatesFromContentMetadata()})},this.sendCustomEvent=function(e,t){n._logger.info("sendEvent(): eventName="+e+n.sessionTypeTag()),n._cwsSession.enqueueCustomEvent(e,t)},this.mergeContentMetadata=function(t){var i={},a={};if(O.isValidString(t.assetName)&&(n._contentMetadata.assetName!=t.assetName?(null!=n._contentMetadata.assetName&&(i[S.REQUEST_KEY_ASSET_NAME]=n._contentMetadata.assetName),a[S.REQUEST_KEY_ASSET_NAME]=t.assetName,n._contentMetadata.assetName=t.assetName):n._logger.warning("mergeContentMetadata(): assetName was not changed.")),O.isValidString(t.applicationName)&&(n._contentMetadata.applicationName!=t.applicationName?(null!=n._contentMetadata.applicationName&&(i[S.REQUEST_KEY_PLAYER_NAME]=n._contentMetadata.applicationName),a[S.REQUEST_KEY_PLAYER_NAME]=t.applicationName,n._contentMetadata.applicationName=t.applicationName):n._logger.warning("mergeContentMetadata(): applicationName was not changed.")),O.isValidString(t.streamUrl)&&(n._contentMetadata.streamUrl!=t.streamUrl?(null!=n._contentMetadata.streamUrl&&(i[S.REQUEST_KEY_STREAM_URL]=n._contentMetadata.streamUrl),a[S.REQUEST_KEY_STREAM_URL]=t.streamUrl,n._contentMetadata.streamUrl=t.streamUrl):n._logger.warning("mergeContentMetadata(): streamUrl was not changed.")),O.isValidString(t.viewerId)&&(n._contentMetadata.viewerId!=t.viewerId?(null!=n._contentMetadata.viewerId&&(i[S.REQUEST_KEY_VIEWER_ID]=n._contentMetadata.viewerId),a[S.REQUEST_KEY_VIEWER_ID]=t.viewerId,n._contentMetadata.viewerId=t.viewerId):n._logger.warning("mergeContentMetadata(): viewerId was not changed.")),O.isValidString(t.defaultResource)&&(n._contentMetadata.defaultResource!=t.defaultResource?(null!=n._contentMetadata.defaultResource&&(i[S.REQUEST_KEY_RESOURCE]=n._contentMetadata.defaultResource),a[S.REQUEST_KEY_RESOURCE]=t.defaultResource,n._contentMetadata.defaultResource=t.defaultResource):n._logger.warning("mergeContentMetadata(): defaultResource was not changed.")),O.isInteger(t.duration)&&t.duration>0&&(n._contentMetadata.duration!=t.duration?(n._cwsSession._contentLengthSec>0&&(i[S.REQUEST_KEY_CONTENT_LENGTH]=n._cwsSession._contentLengthSec),a[S.REQUEST_KEY_CONTENT_LENGTH]=t.duration,n._contentMetadata.duration=t.duration):n._logger.warning("mergeContentMetadata(): duration was not changed.")),O.isInteger(t.encodedFrameRate)&&t.encodedFrameRate>0&&(n._contentMetadata.encodedFrameRate!=t.encodedFrameRate?(n._contentMetadata.encodedFrameRate>-1&&(i[S.REQUEST_KEY_ENCODED_FRAME_RATE]=n._contentMetadata.encodedFrameRate),a[S.REQUEST_KEY_ENCODED_FRAME_RATE]=t.encodedFrameRate,n._contentMetadata.encodedFrameRate=t.encodedFrameRate):n._logger.warning("mergeContentMetadata(): encodedFrameRate was not changed.")),t.streamType!=r.StreamType.UNKNOWN&&(n._contentMetadata.streamType!=t.streamType?(n._contentMetadata.streamType!=r.StreamType.UNKNOWN&&(n._contentMetadata.streamType==e.ContentMetadata.StreamType.LIVE?i[S.REQUEST_KEY_IS_LIVE]=!0:i[S.REQUEST_KEY_IS_LIVE]=!1),t.streamType==e.ContentMetadata.StreamType.LIVE?a[S.REQUEST_KEY_IS_LIVE]=!0:a[S.REQUEST_KEY_IS_LIVE]=!1,n._contentMetadata.streamType=t.streamType):n._logger.warning("mergeContentMetadata(): streamType was not changed.")),O.dictCount(t.custom)>0){var o={},s={};for(var _ in t.custom)n._contentMetadata.custom[_]!=t.custom[_]?(o[_]=t.custom[_],n._contentMetadata.custom[_]&&(s[_]=n._contentMetadata.custom[_]),n._contentMetadata.custom[_]=t.custom[_]):n._logger.info("mergeContentMetadata(): custom."+_+" was not changed.");O.dictCount(o)>0?(O.dictCount(s)>0&&(i[S.REQUEST_KEY_TAGS]=s),a[S.REQUEST_KEY_TAGS]=o):n._logger.warning("mergeContentMetadata(): custom was not changed.")}O.dictCount(a)>0&&n._cwsSession.declareStateChange(a,i)},this.isGlobalSession=function(){return n._global==I.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return n._global==I.SESSION_TYPE.VIDEO},this.isAdSession=function(){return n._global==I.SESSION_TYPE.AD},this.sessionTypeTag=function(){return n.isGlobalSession()?" (global session)":""}});m.DEFAULT_HEARTBEAT_ERROR_MESSAGE="received no response (or a bad response) to heartbeat POST request";var v=t.SessionFactory=function(){function e(e,n,i,r){t._client=e,t._clientSettings=n,t._clientConfig=i,t._systemFactory=r,t._logger=t._systemFactory.buildLogger(),t._logger.setModuleName("SessionFactory"),t._nextSessionKey=0,t._sessionsByKey={}}var t=this;t._logger=null,t._logBuffer=null,t._nextSessionKey=0,t._sessionsByKey=null,e.apply(t,arguments),this.cleanup=function(){t._logger=null,t._logBuffer=null;for(var e in t._sessionsByKey)t._sessionsByKey[e].cleanup();t._sessionsByKey=null,t._nextSessionKey=0},this.newSessionKey=function(){var e=t._nextSessionKey;return t._nextSessionKey++,e},this.makeVideoSession=function(e,n){return null==e&&(e=new r),t.makeSession(e,n)},this.makeGlobalSession=function(e){return t.makeSession(e,I.SESSION_TYPE.GLOBAL)},this.generateSessionId=function(){return U.integer32()},this.makeSession=function(e,n){var i=e.clone(),r=t.generateSessionId(),a=t._systemFactory.buildSession(t._client,t._clientSettings,t._clientConfig,r,n,i),o=t.newSessionKey();return t.addSession(o,a),a.start(),o},this.getSession=function(e){var n=t._sessionsByKey[e];return null==n&&t._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),n},this.getVideoSession=function(e){var n=this.getSession(e);return null!=n&&(n.isVideoSession()||n.isAdSession()||(t._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),n=null)),n},this.addSession=function(e,n){t._sessionsByKey[e]=n},this.removeSession=function(e){delete t._sessionsByKey[e]},this.cleanupSession=function(e){var n=t.getSession(e);t.removeSession(e),n.cleanup()}},p=t.CallbackWithTimeout=function(e){this._timer=e,this.getWrapperCallback=function(e,t,n){var i=!1,r=function(){i||(i=!0,e(!1,n+" ("+t+" ms)"))};return this._timer.createOnce(r,t,"CallbackWithTimeout.wrap"),function(t,n){i||(i=!0,e(t,n))}}},N=t.Config=function(e,t,n){var i=this;this._logger=e,this._logger.setModuleName("Config"),this._storage=t,this._jsonInterface=n,this._defaultConfig={clientId:S.DEFAULT_CLIENT_ID,sendLogs:!1,maxHbInfos:S.DEFAULT_MAX_HEARTBEAT_INFOS},this._config=O.ObjectShallowCopy(this._defaultConfig),this._loaded=!1,this._loadedEmpty=!1,this._waitingConsumers=[],this.isReady=function(){return this._loaded},this.load=function(){var e=function(e,t){e?(i._parse(t),i._logger.debug("load(): configuration successfully loaded from local storage"+(i._loadedEmpty?" (was empty)":"")+".")):i._logger.error("load(): error loading configuration from local storage: "+t),i._loaded=!0,i._notify()};this._storage.load(N.STORAGE_KEY,e)},this._parse=function(e){var t=this._jsonInterface.decode(e);if(null==t)return void(this._loadedEmpty=!0);var n=t[N.CONFIG_STORAGE_KEY_CLIENT_ID];null!=n&&n!=S.DEFAULT_CLIENT_ID&&""!=n&&"null"!=n&&(this._config[N.CONFIG_KEY_CLIENT_ID]=n,this._logger.debug("parse(): loaded clientId="+n+" (from local storage)"))},this._marshall=function(){var e={};return e[N.CONFIG_STORAGE_KEY_CLIENT_ID]=this._config.clientId,this._logger.debug("_marshall(): saving clientId="+this._config.clientId+" (to local storage)"),this._jsonInterface.encode(e)},this.save=function(){var e=function(e,t){e?i._logger.debug("save(): configuration successfully saved to local storage."):i._logger.error("save(): error saving configuration to local storage: "+t)};this._storage.save(N.STORAGE_KEY,this._marshall(),e)},this.register=function(e){if(this.isReady())return void e();this._waitingConsumers.push(e)},this.get=function(e){return this._loaded?this._config[e]:null},this.set=function(e,t){this._loaded&&(this._config[e]=t)},this._notify=function(){for(var e;null!=(e=this._waitingConsumers.shift());)e()}};N.STORAGE_KEY="sdkConfig",N.CONFIG_STORAGE_KEY_CLIENT_ID="clId",N.CONFIG_KEY_CLIENT_ID="clientId",N.CONFIG_KEY_SEND_LOGS="sendLogs",N.CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxHbInfos",N.CONVIVAID_FP_PREFIX="c3.fp.",N.ConvivaIdErrorCodes={CONVIVAID_NA:"0",CONVIVAID_FETCH_ERROR:"1",CONVIVAID_USER_OPTOUT:"2",CONVIVAID_PRIVACY_RESTRICTION:"3",CONVIVAID_SERVER_RESTRICTION:"4",CONVIVAID_USER_OPT_DELETE:"5",CONVIVAID_USER_NO_RESTRICTION:"6"};var C=t.EventQueue=function(){this._events=[],this._nextEventNumber=0,this.enqueue=function(e){this._events.push(e)},this.getNumber=function(){var e=this._nextEventNumber;return this._nextEventNumber++,e},this.flush=function(){var e=this._events;return this._events=[],e}},A=t.ExceptionCatcher=function(e,t,n){this._logger=e,this._logger.setModuleName("ExceptionCatcher"),this._ping=t,this._systemSettings=n,this.runProtected=function(e,t,n){try{t()}catch(t){if(null!=n)n(t);else{if(this._systemSettings.allowUncaughtExceptions)throw t;this.onUncaughtException(e,t)}}},this.onUncaughtException=function(e,t){var n="Uncaught exception: "+e+": "+t.toString();if(null!=this._ping)try{this._ping.send(n)}catch(e){this._logger.error("Caught exception while sending ping: "+e.toString())}this._logger.error(n)}},y=t.GatewayControl=function(e,t,n,i){var r=this;this._clientSettings=e,this._logger=t,this._logger.setModuleName("GatewayControl"),this._httpClient=n,this._jsonInterface=i,this.send=function(e,t){var n=this._jsonInterface.encode(e),i=this._clientSettings.gatewayUrl+S.gatewayPath,a=function(e,n){if(e){var i=r._jsonInterface.decode(n);t(e,i)}else t(e,n)};this._httpClient.request("POST",i,n,"application/json",a)}},O=t.Lang={};O.isMeaningfulString=function(e){return O.isValidString(e)&&null!=e&&"undefined"!=e&&"null"!=e},O.sanitizeStringToStringObject=function(e){var t={};for(var n in e)if(O.isMeaningfulString(n)){var i=e[n];O.isMeaningfulString(i)&&(t[n]=i)}return t},O.validateInterface=function(e,t,n){if(null==e)throw new Error("Expected "+n+" implementation is null.");for(var i in t)if("function"!=typeof e[i])throw new Error("Expected method "+i+" in "+n+" implementation.")},O.dictCount=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},O.ToString=function(e){return""+e},O.NumberToInt=function(e){return Math.floor(e)},O.NumberToUnsignedInt=function(e){return Math.abs(O.NumberToInt(e))},O.AsBoolean=function(e){return Boolean(e)},O.isValidString=function(e){return"string"==typeof e&&""!==e},O.stringStartsWith=function(e,t){return"string"==typeof e&&"string"==typeof t&&"function"==typeof e.indexOf&&0===e.indexOf(t)},O.isBoolean=function(e){return"boolean"==typeof e},O.UrlEncodeString=function(e){return escape(e)},O.isObject=function(e){return"object"==typeof e},O.ObjectToString=function(e){var t="";for(var n in e)t+=n+"="+e[n];return"Object{"+t+"}"},O.ObjectShallowCopyOmitNull=function(e){var t=O.ObjectShallowCopy(e);for(var n in t)null==t[n]&&delete t[n];return t},O.ObjectShallowCopy=function(e){var t={};for(var n in e)t[n]=e[n];return t},O.ObjectShallowEquals=function(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){if(O.dictCount(e)!==O.dictCount(t))return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}return e===t},O.isInteger=function(e){return"number"==typeof e&&Math.round(e)===e},O.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},O.ArrayEquals=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(O.isArray(e[n])&&O.isArray(t[n])){if(!O.ArrayEquals(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0},O.isObjectDefinePropertyPresent=function(){return void 0!==Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()},O.defGet=function(e,t,n){if(O.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n});else{if(void 0===e.__defineGetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineGetter__");e.__defineGetter__(t,n)}},O.defSet=function(e,t,n){if(O.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,set:n});else{if(void 0===e.__defineSetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineSetter__");e.__defineSetter__(t,n)}},function(){var e={};e.two32=4294967296,e.MaxValue=e.two32-1,e.MinValue=0,O.UInt32=e,O.UInt32.Cast=function(t){var n=parseInt(t,10);return n>e.MaxValue?n%=e.two32:n<e.MinValue&&(n=-n%e.two32,n=e.two32-n),n},O.UInt32.InRange=function(t){var n=parseInt(t,10);return n<=e.MaxValue&&n>=e.MinValue};var t={};t.MaxValue=2147483647,t.MinValue=-2147483648,O.Int32=t,O.Int32.Cast=function(e){var n=parseInt(e,10);return n>t.MaxValue?n%=t.MaxValue:n<t.MinValue&&(n=-n%t.MaxValue,n=t.MaxValue-n),n},O.Int32.InRange=function(e){var n=parseInt(e,10);return n<=t.MaxValue&&n>=t.MinValue}}();var P=t.LogBuffer=function(){this._buffer=[],this.add=function(e){this._buffer.length>=32&&this._buffer.shift(),this._buffer.push(e)},this.flush=function(){var e=this._buffer;return this._buffer=[],e}},M=t.Ping=function(e,t,i){this._isSendingPing=!1,this._cachedBasePingUrl=null,this._logger=e,this._logger.setModuleName("Ping"),this._httpClient=t,this._clientSettings=i,this.send=function(e){if(!this._isSendingPing){this._isSendingPing=!0;var t=this.getBasePingUrl()+"&d="+O.UrlEncodeString(e.toString());this._logger.error("send(): "+t),this._httpClient.request("GET",t,null,null,null),this._isSendingPing=!1}},this.getBasePingUrl=function(){if(!this._cachedBasePingUrl){var e=M.SERVICE_URL+"?comp="+M.COMPONENT_NAME+"&clv="+n.version;if(this._clientSettings&&(e+="&cid="+this._clientSettings.customerKey),e+="&sch="+S.SDK_METADATA_SCHEMA,!this._clientSettings)return e;this._cachedBasePingUrl=e}return this._cachedBasePingUrl}};M.COMPONENT_NAME="sdkjs",M.SERVICE_URL="https://pings.conviva.com/ping.ping";var U=t.Random={};U.maxUInt32=4294967295,U.maxInt32=2147483647,U.minInt32=-2147483648,U.integer32=function(){return Math.floor(Math.random()*U.maxUInt32)+U.minInt32},U.uinteger32=function(){return Math.floor(Math.random()*U.maxUInt32)};var b=t.Sanitize={};b.Integer=function(e,t,n,i){if(isNaN(e))return i;if("number"!=typeof e)return i;if(e==i)return i;var r=O.NumberToInt(e);return b.EnforceBoundaries(r,t,n)},b.EnforceBoundaries=function(e,t,n){return null!=n&&e>n?e=n:null!=t&&e<t&&(e=t),e},b.sanitizeSpecialIntegerValue=function(e){return-1==e||-2==e?e:e=b.Integer(e,0,null,-1)};var w=(t.StreamerError=function(){function e(e,n){t.errorCode=e,t.severity=n}var t=this;t.errorCode=null,t.severity=n.ErrorSeverity.FATAL,e.apply(t,arguments)},t.HttpClient=function(e,t,n,i){this._logger=e,this._logger.setModuleName("HttpClient"),this._httpInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.request=function(e,t,n,i,r){var a=1e3*this._systemSettings.httpTimeout,o=this._callbackWithTimeout.getWrapperCallback(r,a,"HTTP timeout");this._logger.debug("request(): calling HttpInterface.makeRequest"),this._httpInterface.makeRequest(e,t,n,i,a,o)}}),D=t.Logger=function(e,t,n,i,r){this._loggingInterface=e,this._timeInterface=t,this._settings=n,this._logBuffer=i,this._packageName=r,this.debug=function(e){this.log(e,o.LogLevel.DEBUG)},this.info=function(e){this.log(e,o.LogLevel.INFO)},this.warning=function(e){this.log(e,o.LogLevel.WARNING)},this.error=function(e){this.log(e,o.LogLevel.ERROR)},this.log=function(e,t){var n=this.formatMessage(e,t);this._logBuffer.add(n),this._settings.logLevel<=t&&this._loggingInterface.consoleLog(n,t)},this.prependModuleName=function(e){var t=e;return t="["+this._moduleName+"] "+t},this.prependPackageName=function(e){var t=e;return t="["+this._packageName+"] "+t},this.prependConvivaNamespace=function(e){var t=e;return t="[Conviva] "+t},this.prependTime=function(e){return"["+(this._timeInterface.getEpochTimeMs()/1e3).toFixed(3).toString()+"] "+e},this.prependLogLevel=function(e,t){var n=D.getLogLevelString(t),i=e;return i="["+n+"] "+i},this.prependSessionId=function(e){var t=e;return null!=this._sessionId&&(t="sid="+this._sessionId+" "+t),t},this.setSessionId=function(e){this._sessionId=e},this.setModuleName=function(e){this._moduleName=e},this.formatMessage=function(e,t){return this.prependConvivaNamespace(this.prependTime(this.prependLogLevel(this.prependPackageName(this.prependModuleName(this.prependSessionId(e))),t)))}};D.getLogLevelString=function(e){var t;switch(e){case o.LogLevel.ERROR:t="ERROR";break;case o.LogLevel.WARNING:t="WARNING";break;case o.LogLevel.INFO:t="INFO";break;case o.LogLevel.DEBUG:t="DEBUG"}return t};var F=t.Storage=function(e,t,n,i){this._logger=e,this._logger.setModuleName("Storage"),this._storageInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.load=function(e,t){var n=this._callbackWithTimeout.getWrapperCallback(t,1e3*this._systemSettings.storageTimeout,"storage load timeout");this._logger.debug("load(): calling StorageInterface.loadData"),this._storageInterface.loadData(F.STORAGE_SPACE,e,n)},this.save=function(e,t,n){var i=this._callbackWithTimeout.getWrapperCallback(n,1e3*this._systemSettings.storageTimeout,"storage save timeout");this._logger.debug("save(): calling StorageInterface.saveData"),this._storageInterface.saveData(F.STORAGE_SPACE,e,t,i)}};F.STORAGE_SPACE="Conviva";var L=t.SystemMetadata=function(t,n,i){this._logger=t,this._logger.setModuleName("SystemMetadata"),this._metadataInterface=n,this._exceptionCatcher=i,this._cachedMetadata=null,this.get=function(){return this._cachedMetadata||this.retrieve(),this._cachedMetadata},this.retrieve=function(){var t={};t[L.BROWSER_NAME]=this._metadataInterface.getBrowserName,t[L.BROWSER_VERSION]=this._metadataInterface.getBrowserVersion,t[L.DEVICE_BRAND]=this._metadataInterface.getDeviceBrand,t[L.DEVICE_MANUFACTURER]=this._metadataInterface.getDeviceManufacturer,t[L.DEVICE_MODEL]=this._metadataInterface.getDeviceModel,t[L.DEVICE_TYPE]=this._metadataInterface.getDeviceType,t[L.DEVICE_VERSION]=this._metadataInterface.getDeviceVersion,t[L.FRAMEWORK_NAME]=this._metadataInterface.getFrameworkName,t[L.FRAMEWORK_VERSION]=this._metadataInterface.getFrameworkVersion,t[L.OPERATING_SYSTEM_NAME]=this._metadataInterface.getOperatingSystemName,t[L.OPERATING_SYSTEM_VERSION]=this._metadataInterface.getOperatingSystemVersion,t[L.DEVICE_CATEGORY]=this._metadataInterface.getDeviceCategory;var n=this;this._logger.debug("retrieve(): calling MetadataInterface methods");for(var i in t)(function(e,t){n._exceptionCatcher.runProtected("Session.getSystemMetadataSchema(): "+e,function(){var i=t[e];t[e]=i.call(n._metadataInterface)})})(i,t),O.isValidString(t[i])||delete t[i];var r=!1;if(void 0!==t[L.DEVICE_TYPE]){for(var a in e.Client.DeviceType)if(t[L.DEVICE_TYPE]===e.Client.DeviceType[a]){r=!0;break}r||delete t[L.DEVICE_TYPE]}if(r=!1,void 0!==t[L.DEVICE_CATEGORY]){for(var o in e.Client.DeviceCategory)if(t[L.DEVICE_CATEGORY]===e.Client.DeviceCategory[o]){r=!0;break}r||delete t[L.DEVICE_CATEGORY]}this._cachedMetadata=O.ObjectShallowCopyOmitNull(t)}};L.BROWSER_NAME="browserName",L.BROWSER_VERSION="browserVersion",L.DEVICE_BRAND="deviceBrand",L.DEVICE_MANUFACTURER="deviceManufacturer",L.DEVICE_MODEL="deviceModel",L.DEVICE_TYPE="deviceType",L.DEVICE_VERSION="deviceVersion",L.FRAMEWORK_NAME="frameworkName",L.FRAMEWORK_VERSION="frameworkVersion",L.OPERATING_SYSTEM_NAME="operatingSystemName",L.OPERATING_SYSTEM_VERSION="operatingSystemVersion",L.DEVICE_CATEGORY="deviceCategory";var V=t.Time=function(e,t){this._timeInterface=e,this._logger=t,this._logger.setModuleName("Time"),this.current=function(){var e=this._timeInterface.getEpochTimeMs();return O.isInteger(e)||this._logger.error("current(): TimeInterface.getEpochTimeMs() did not return an integer ("+e+")"),e}},K=t.Timer=function(e,t,n){var i=this;this._logger=e,this._logger.setModuleName("Timer"),this._timerInterface=t,this._exceptionCatcher=n,this.create=function(e,t,n){var r=function(){i._exceptionCatcher.runProtected(n,function(){e()})};return this.createTimer(r,t,n)},this.createOnce=function(e,t,n){var r={cancel:null},a=function(){i._exceptionCatcher.runProtected(n,function(){r&&"function"==typeof r.cancel&&(r.cancel(),r.cancel=null,r=null),e()})},o=this.createTimer(a,t,n);return r.cancel=o,o},this.createTimer=function(e,t,n){return this._logger.debug("createTimer(): calling TimerInterface.create"),this._timerInterface.createTimer(e,t,n)}}}()}(),e})}});